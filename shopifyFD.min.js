(function(){if("undefined"!==typeof Shopify)if("undefined"!==typeof jQuery)if($("#shopifyjs").length)"function"===typeof Shopify.Flash.error&&Shopify.Flash.error("Error. ShopifyFD already loaded!");else{var n=document;if(1<n.URL.indexOf("myshopify.com/admin")){var b=function(){var k={debug:!1,drag_on:!0,author:"freakdesign",version:20131111,alpha:!1,omega:!1,countries:!1,wait:1E3,api_count:0,api_limit:250,metafields:{},autosave:!1,content:$("#content"),body:$("body")};return{escape:function(b){return b.replace(/[\\]/g,
"\\\\").replace(/[\"]/g,'\\"').replace(/[\/]/g,"\\/").replace(/[\b]/g,"\\b").replace(/[\f]/g,"\\f").replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r").replace(/[\t]/g,"\\t")},redirect:function(a){a&&"function"===typeof Batman?Batman.redirect(a):b.notice("Unable to redirect",!0)},createCookie:function(b,c,d){if(d){var e=new Date;e.setTime(e.getTime()+864E5*d);d="; expires="+e.toGMTString()}else d="";document.cookie=b+"="+c+d+"; path=/"},readCookie:function(b){b+="=";for(var c=document.cookie.split(";"),
d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return null},notice:function(b,c){"function"===typeof Shopify.Flash.error&&"function"===typeof Shopify.Flash.notice&&(c?Shopify.Flash.error(b):Shopify.Flash.notice(b))},about_app:function(){b.fd_modal(!0,'<p>ShopifyFD is "honor-ware", which means that we trust each other to be nice. As the developer of it, I\'m committed to keep the tool something that\'s actually useful. By releasing new features and correcting possible bugs on a constant basis I can do just that, but I need your support. If you use it and intend to keep it, please sponsor its development by making a small <a target="_blank" href="http://shopify.freakdesign.com.au/#donate">contribution</a>.</p><p>You can track changes by keeping an eye on the project page or following me on <a target="_blank" href="https://twitter.com/freakdesign">twitter</a>.</p><p><h4 style="margin-top:1em">Resources and links</h4><ul><li><a href="http://shopify.freakdesign.com.au" target="_blank">Project home page</a></li><li><a href="http://goo.gl/OsFK2d" target="_blank">Feature Request</a></li><li><a href="http://bit.ly/shopifyFD_forum" target="_blank">Shopify forum post</a></li></ul></p>',
"About this tool",!0);return!1},show_notification:function(){b.fd_modal(!0,"<ul><li>With recent updates to the Shopify Dashboard many features have been lost, or no longer work as well. If you find a bug, report it!</li></ul>","ShopifyFD: Recent updates and news");$("#getnotifications").find("i").removeClass("blinker")},flash_notification:function(){$("#getnotifications").find("i").addClass("blinker")},createbackup:function(a){if(a){var c=$("iframe").contents().find("#tinymce").html();$.ajax({type:"POST",
url:n.URL+"/metafields.json",dataType:"json",data:{metafield:{namespace:"backups",key:a,value:c,value_type:"string"}},success:function(a){b.updatedropdown();b.notice("Backup saved")},error:function(a){a=JSON.parse(a.responseText);b.notice(a.errors.value[0],!0)}})}},loadmeta:function(a,c){var d="/admin/"+b.data("alpha")+"/"+b.data("omega")+"/metafields.json";"general"===b.data("omega")&&(d="/admin/metafields.json");"articles"===b.data("alpha")&&(d="/admin/articles/"+b.data("omega")+"/metafields.json");
$.getJSON(d,function(d){var f="";if(d=d.metafields){b.data("m",d);"products"==b.data("alpha")&&b.setup_copypaste();var h=$("#metacount");h.text(d.length).addClass("active");0===d.length?h.removeClass("active"):h.addClass("active");for(var h=0,g=d.length;h<g;h++)f+='<option data-type="'+d[h].value_type+'" data-id="'+d[h].id+'">'+d[h].namespace+"."+d[h].key+"</option>",c.metafields[d[h].id]={namespace:d[h].namespace,value:d[h].value,key:d[h].key},"backups"==d[h].namespace&&(b.flog("hasbackup!"),$("#restorebackup").show(),
b.data("hasbackup",!0));f='<select id="metafieldselect"><option value="">Select or create a metafield</option>'+f+"</select>"}else f='<select id="metafieldselect"><option value="">Select or create a metafield</option></select>';a.html(f).append('<label style="margin-top:1em">Add New Metafield</label><input class="ssb" maxlength="20" type="text" id="metafield_namespace" placeholder="namespace"><input class="ssb" maxlength="30" type="text" id="metafield_key" placeholder="key"><textarea class="ssb" id="metafield_value" placeholder="value"></textarea><input type="hidden" id="metafield_id"><a class="btn btn-slim savemymeta" id="shopifyjs_savemetafield">Save</a> <a class="int btn btn-slim savemymeta" id="shopifyjs_savemetafield_int">Save as Integer</a> <a class="btn btn-slim hidden delete" id="shopifyjs_deletemetafield">Delete</a><p style="margin-top:1em;line-height:1"><small><a id="advanced_meta_features" href="javascript:void(0)">Toggle advanced features</a><br>Please note: Using the save button top right will NOT save these metafields. Be sure to click Save above.</small></p><div id="advanced_meta" class="hidden"><p style="border-bottom: 1px solid #ccc;">Handle Helper <a id="adv_clear_cache" style="float:right" href="javascript:void(0)">Clear cache</a></p><p><a id="adv_get_collections" class="btn btn-slim" href="">Get collections</a></p><p><a id="adv_get_products" class="btn btn-slim" href="">Get products</a> <small>not suitable for large stores</small></p></div>');
$("#advanced_meta_features").off("click").on("click",function(){$("#advanced_meta").eq(0).toggleClass("hidden");return!1});$("#adv_clear_cache").off("click").on("click",function(){$("#advanced_meta").find("select").remove().end().find("a").show();b.data("products",!1);b.data("collections",!1);return!1});$("#adv_get_products").off("click").on("click",function(){var a=$(this);if(b.data("products")){for(var c=b.data("products"),d="",f=$("<select />",{}).change(function(){var b=$(this);$("#metafield_value").val(b.val())}).html('<option value="">Add product handle as value</option>'),
e=0,h=c.products.length;e<h;e++)d+='<option value="'+c.products[e].handle+'">'+c.products[e].title+"</option>";f.append(d);a.after(f).hide()}else $.ajax({type:"GET",url:"/admin/products.json?limit=250",dataType:"json",success:function(c){if(c.products.length){b.data("products",c);for(var d="",f=$("<select />",{}).change(function(){var b=$(this);$("#metafield_value").val(b.val())}).html('<option value="">Add product handle as value</option>'),e=0,h=c.products.length;e<h;e++)d+='<option value="'+c.products[e].handle+
'">'+c.products[e].title+"</option>";f.append(d);a.after(f).hide()}},fail:function(){b.notice("Failed to load products",!0)}});return!1});$("#adv_get_collections").off("click").on("click",function(){var a=$(this);if(b.data("collections")){for(var c=b.data("collections"),d="",f=$("<select />",{}).change(function(){var b=$(this);$("#metafield_value").val(b.val())}).html('<option value="">Add collection handle as value</option>'),e=0,h=c.collections.length;e<h;e++)d+='<option value="'+c.collections[e].handle+
'">'+c.collections[e].title+"</option>";f.append(d);a.after(f).hide()}else $.ajax({type:"GET",url:"/admin/collections.json?limit=250",dataType:"json",success:function(c){if(c.collections.length){b.data("collections",c);for(var d="",f=$("<select />",{}).change(function(){var b=$(this);$("#metafield_value").val(b.val())}).html('<option value="">Add collection handle as value</option>'),e=0,h=c.collections.length;e<h;e++)d+='<option value="'+c.collections[e].handle+'">'+c.collections[e].title+"</option>";
f.append(d);a.after(f).hide()}},fail:function(){b.notice("Failed to load collections",!0)}});return!1});$("#metafieldselect").change(function(){var a=$(this).find(":selected");if(a.attr("data-id")){var d=c.metafields[a.attr("data-id")];a.attr("data-type");$("#metafield_namespace").val(d.namespace).prop("disabled",!0);$("#metafield_key").val(d.key).prop("disabled",!0);$("#metafield_value").val(d.value);$("#metafield_id").val(a.attr("data-id"));$("#shopifyjs_deletemetafield").removeClass("hidden")}else b.clearmetaform()});
$("#shopifyjs_deletemetafield").on("click",function(){var a=$("#metafield_id").val(),c=n.URL+"/metafields/"+a+".json";"general"===b.data("omega")&&(c="/admin/metafields/"+a+".json");"articles"===b.data("alpha")&&(c="/admin/articles/"+b.data("omega")+"/metafields/"+a+".json");a&&$.ajax({type:"DELETE",url:c,success:function(a){b.flog(a);b.notice("Metafield deleted");b.updatedropdown()},error:function(a){b.notice("Failed to delete",!0)}})});$("div.sub_section-summary a.savemymeta").off("click").on("click",
function(){var a="string";$(this).hasClass("int")&&(a="integer");var c=$("#metafield_namespace").val(),d=$("#metafield_key").val(),f=$("#metafield_value").val(),e=$("#metafield_id").val(),c={metafield:{namespace:c,key:d,value:f,value_type:a}},a={metafield:{id:e,value:f,value_type:a}};5<e.length?(f=n.URL+"/metafields/"+e+".json","general"===b.data("omega")&&(f="/admin/metafields/"+e+".json"),$.ajax({type:"PUT",url:f,dataType:"json",data:a,success:function(a){b.updatedropdown();b.flog(a);b.notice("Metafield updated")}})):
(f=n.URL+"/metafields.json","general"===b.data("omega")&&(f="/admin/metafields.json"),"articles"===b.data("alpha")&&(f="/admin/articles/"+b.data("omega")+"/metafields.json"),$.ajax({type:"POST",url:f,dataType:"json",data:c,success:function(a){b.updatedropdown();b.notice("Metafield saved")},error:function(a){a=JSON.parse(a.responseText);var c="";a.errors.namespace&&(c+="Namespace "+b.escape(a.errors.namespace[0])+". ");a.errors.key&&(c+="Key "+b.escape(a.errors.key[0])+". ");a.errors.value&&(c+="Value "+
b.escape(a.errors.value[0])+". ");b.notice("Metafield failed to save: "+c,!0)}}));return!1})})},bulk_save_metafield_queue:function(a,c,d){$.ajax({type:"POST",url:"/admin/products/"+b.data("products")[c].id+"/metafields.json",dataType:"json",data:a,success:function(e){d&&(e=d.val(),d.val(e+c+": "+b.data("products")[c].id+": ok\n"));c+1<b.data("products").length?b.bulk_save_metafield_queue(a,c+1,d):("products"==b.data("alpha")&&b.updatedropdown(),b.notice("Bulk changes done!"))}})},bulkmetafields:function(){var a=
$('<h2 class="warning"><strong>Warning:</strong> This section can make bulk changes to your product metafields. There is no undo should something go wrong so be very sure you want to attempt this.</h2><table><tr><td>Namespace</td><td><input id="bulk_namespace" placeholder="Namespace" type="text" /></td></tr><tr><td>Key</td><td><input id="bulk_key" placeholder="Key" type="text" /></td></tr><tr><td>Value</td><td><input id="bulk_value" type="text" placeholder="value" /></td></tr><tr><td colspan="2"><p><strong>Note:</strong> Any existing metafield with the same namespace and key will be overwritten. Have I given you enough warning?</p></td></tr><tr><td><a class="btn create">Save</a> <a class="btn createint">Save Integer</a></td><td><span style="display:none"><a class="btn delete">Delete</a> <input type="text" style="width:50%" placeholder="Type delete" /></span></td></tr><tr><td colspan="2"><textarea class="debug" placeholder="Data Output (future use only)"></textarea></td></tr></table>'),
c=a.find("a.create"),d=a.find("a.createint");a.find("a.update");a.find("a.delete");var e=a.find("#bulk_namespace"),f=a.find("#bulk_key"),h=a.find("#bulk_value"),g=a.find("textarea.debug"),l=function(){return 1<e.val().length&&1<f.val().length&&1<h.val().length?!0:!1};c.off("click").on("click",function(){if(l){var a={metafield:{namespace:e.val(),key:f.val(),value:h.val(),value_type:"string"}};b.bulk_save_metafield_queue(a,0,g)}else b.notice("No empty fields allowed")});d.off("click").on("click",function(){if(l)if(isNaN(h.val()))b.notice("Value not an integer",
!0);else{g.val(b.data("products"));var a={metafield:{namespace:e.val(),key:f.val(),value:h.val(),value_type:"integer"}};b.bulk_save_metafield_queue(a,0,g)}else b.notice("No empty fields allowed",!0)});$.ajax({type:"GET",url:"/admin/products.json?fields=id,title",dataType:"json",success:function(c){c.products&&(c.products.length?(b.data("products",c.products),b.fd_modal(!0,a,"Bulk Metafield editing (for "+c.products.length+" products)",!0)):b.notice("No products found",!0))},error:function(a){b.notice("Error getting products",
!0)}})},clearformatting:function(){var b=$("iframe").contents().find("#tinymce"),c=document.createElement("div");c.innerHTML=b.html();b.text(c.textContent||c.innerText||"")},clearmetaform:function(){$("#metafield_namespace").val("").prop("disabled",!1);$("#metafield_key").val("").prop("disabled",!1);$("#metafield_value").val("");$("#metafield_id").val("");$("#shopifyjs_deletemetafield").addClass("hidden")},supports_html5_storage:function(){try{return"localStorage"in window&&null!==window.localStorage}catch(b){return!1}},
kill_drag_drop:function(){if(b.data("drag_on")){var a=document.documentElement;a.className="";a.ondragover=function(){return!1};a.ondragleave=function(){return!1};a.ondragend=function(){return!1};a.ondrop=function(){}}},set_drag_drop:function(){if(b.data("drag_on")&&function(){var b=document.createElement("div");return"draggable"in b||"ondragstart"in b&&"ondrop"in b}()){b.flog("has dnd");var a=document.documentElement;a.ondragover=function(){this.className="dragit";return!1};a.ondragleave=function(){this.className=
"";return!1};a.ondragend=function(){this.className="";return!1};a.ondrop=function(a){a.preventDefault&&a.preventDefault();var d=a.dataTransfer.files,e=d.length,f=0,h=new FileReader,g={};h.onload=function(a){b.flog("load");a=a.target.result.split(",")[1];g[f]={name:d[f].name,data:a};f++;f<e?(b.notice("Reading file ["+(f+1)+"] contents..."),h.readAsDataURL(d[f])):b.do_upload(g)};e&&(document.documentElement.className="dragit",b.notice("Reading file ["+(f+1)+"] contents..."),h.readAsDataURL(d[f]));return!1}}},
do_upload:function(a){if(b.data("drag_on")){var c=Object.keys(a).length,d=0,e=b.data("themeID");"themes"==b.data("alpha")&&(e=b.data("omega"));"settings"!=b.data("omega")||isNaN(b.data("alpha"))||(e=b.data("alpha"));if(e){var f=function(){$.ajax({type:"PUT",url:"/admin/themes/"+e+"/assets.json",data:{asset:{key:"assets/"+a[d].name,attachment:a[d].data}},success:function(){b.notice(a[d].name+" uploaded ("+(d+1)+"/"+c+")");d++;d<c&&f();d==c&&(document.documentElement.className="")},error:function(){b.notice("File upload failed",
!0);document.documentElement.className=""}})};f()}else b.notice("Theme ID not found",!0)}},get_product_count:function(){$.ajax({type:"GET",url:"/admin/products/count.json",success:function(a){a&&b.data("product_count",a.count)}})},get_all_product_metafields:function(){b.data("product_count");b.data("api_limit")},save_variant_metafield:function(a,c,d,e,f,h){b.flog(a,c,d,e,f,h);var g="string";h&&(g="integer");f.length?(c={metafield:{id:f,value:e,value_type:g}},$.ajax({type:"PUT",url:"/admin/variants/"+
a+"/metafields/"+f+".json",data:c,success:function(c){b.flog(c);b.setup_vrow(a);b.notice("Metafield updated")},error:function(c){b.setup_vrow(a);b.notice("Error saving",!0)}})):(c={metafield:{namespace:c,key:d,value:e,value_type:g}},$.ajax({type:"POST",url:"/admin/variants/"+a+"/metafields.json",data:c,success:function(c){b.flog(c);b.setup_vrow(a);b.notice("Metafield saved")},error:function(c){b.setup_vrow(a);b.notice("Error Saving",!0)}}))},delete_variant_metafield:function(a,c){$.ajax({type:"DELETE",
url:"/admin/variants/"+a+"/metafields/"+c+".json",success:function(c){b.flog(c);b.setup_vrow(a);b.notice("Metafield deleted")},error:function(c){b.setup_vrow(a);b.notice("Failed to delete",!0)}})},variant_fillfields:function(a){for(var c=0,d=b.data("vm").length;c<d;c++)if(o=b.data("vm")[c],parseInt(o.id)==parseInt(a))return o;return!1},setup_vrow:function(a){$("#mv_namespace").val("").prop("disabled",!1);$("#mv_key").val("").prop("disabled",!1);$("#mv_value").val("");b.data("current_vid","");var c=
function(b){return'<option class="meta" value="'+b.id+'">'+b.namespace+"."+b.key+"</option>"};a?$.ajax({type:"GET",url:"/admin/variants/"+a+"/metafields.json",success:function(d){$("#vrow option.meta").remove();if(m=d.metafields)b.data("vm",m),m.length?$("#vrow select").addClass("active"):$("#vrow select").removeClass("active");d=0;for(var e=m.length;d<e;d++)$("#vrow select").append(c(m[d]));$("#vrow .delete").hide();$("#vrow .save").off("click").on("click",function(){b.data("current_vid")||b.data("current_vid",
"");b.save_variant_metafield(a,$("#mv_namespace").val(),$("#mv_key").val(),$("#mv_value").val(),b.data("current_vid"));return!1});$("#vrow .saveinteger").off("click").on("click",function(){b.data("current_vid")||b.data("current_vid","");b.save_variant_metafield(a,$("#mv_namespace").val(),$("#mv_key").val(),$("#mv_value").val(),b.data("current_vid"),!0);return!1});$("#vrow .delete").off("click").on("click",function(){b.delete_variant_metafield(a,b.data("current_vid"));return!1});$("#vrow select").eq(0).off("change").change(function(){var a=
$(this).val();b.data("current_vid",a);b.flog(b.data("vm"));if(a.length){if($("#mv_namespace").prop("disabled",!0),$("#mv_key").prop("disabled",!0),$("#vrow .delete").show(),a=b.variant_fillfields(a))$("#mv_namespace").val(a.namespace),$("#mv_key").val(a.key),$("#mv_value").val(a.value)}else $("#mv_namespace").prop("disabled",!1),$("#mv_key").prop("disabled",!1),$("#vrow .delete").hide()});$("#vrow .mybuttons").fadeIn()},error:function(a){b.notice("Error grabbing metafields",!0)}}):b.notice("Could not find ID",
!0)},panel_editvariantmeta:function(){$(".row.section.inventory .section-summary p").after('<p class="box notice">To edit metafields for the variant click in the variant ID number field.</p>');$("td.vid input").on("change",function(){var b=$(this);b.val(b.attr("data-val"))});$("td.vid input").on("click",function(){$("#vrow").remove();var a=$(this),c=a.attr("data-val");a.select();b.flog(c);b.data("currentvrow",c);$("tr.variant.active").removeClass("active");a=a.parent().parent();tp_td=a.find("td").length+
1;a.addClass("active").after('<tr id="vrow"><td colspan="'+tp_td+'"><div class="vbox"><fieldset><select><option value="">Select or create a metafield</option></select><input id="mv_namespace" placeholder="namespace" /><input id="mv_key" placeholder="key" /><input id="mv_value" placeholder="value" /></fieldset><span class="mybuttons"><a class="save btn btn-slim" href="#">Save</a> <a class="btn btn-slim saveinteger" href="#">Save as Integer</a> <a title="Delete" class="delete ico ico-16 ico-delete" href="#">delete</a></span></div></td></tr>');
b.setup_vrow(c)})},btn_removealltags:function(){$("div.row.section.tags div.section-summary").eq(0).append('<a id="addalltags" href="#" class="btn">Add all tags</a> <a id="removealltags" href="#" class="btn">Remove all tags</a>');$("#removealltags").on("click",function(){$("ul.tokenized-list").eq(0).find("a").click();return!1});$("#addalltags").on("click",function(){$("ul.addtags").eq(0).find("span:not(.inactive)").click();return!1})},flog:function(a){b.data("debug")&&console.log(a)},fd_modal_update:function(b,
c,d){b=$("#fdmodal");b.length&&b.remove()},fd_modal:function(a,c,d,e){b.flog("fdmodal");var f=$("#fdmodal");if(a){f.length&&f.remove();a=$('<div id="fdmodal" class="modalWindow"><div class="main content"><header></header></div></div>');d&&a.find("header").html("<h2>"+d+"</h2>");c&&(c=$("<div/>",{}).append(c),a.find("div.main.content").append(c));if(e)e=$('<a href="#" class="close-modal">X</a>'),e.on("click",function(){b.fd_modal(!1);return!1}),a.find("header").prepend(e).end().fadeIn();else a.fadeIn().on("click",
function(){b.fd_modal(!1)});$("body").append(a)}else f.off("click").remove()},restorebackup:function(a){a=$("iframe").contents().find("#tinymce");var c=b.data("m");if(c)for(var d=0,e=c.length;d<e;d++)"backups"==c[d].namespace&&(a.html(c[d].value),b.notice("Backup restored"));else b.notice("Error, nothing to restore",!0)},setup_discounts:function(){var a=$("<ul/>",{"class":"segmented",id:"discount_buttons"}),c=$("<li/>"),d=$("<a/>",{"class":"btn btn-separate",href:"#",title:"Disable all codes below"}).html("Disable codes").on("click",
function(){$('#discount-table a[data-event-click="discount.disable"]').click();return!1}),e=$("<a/>",{"class":"btn btn-separate",href:"#",title:"Enable all codes below"}).html("Enable codes").on("click",function(){$('#discount-table a[data-event-click="discount.enable"]').click();return!1}),f=$("<a/>",{"class":"btn btn-separate disabled",href:"#"}).html("Bulk create").on("click",function(){b.data("debug")||b.fd_modal(!0,"<p>This is on the todo list. Will get to it soon(ish)</p></div>","Bulk create discount codes",
!0);return!1});c.append(d,e,f);a.append(c);$(".header-right .segmented").eq(0).after(a)},setup_articles:function(){b.flog("setup_articles");$("div.span6.section-summary a.view-in-store").remove();$("div.span6.section-summary").eq(0).find("p, h1").remove().end().append('<div class="sub_section-summary"><h1><strong>Metafields</strong> <span id="metacount">0</span></h1><div class="content"><i class="ico ico-20 ico-20-loading"></i></div></div>');var a=$("div.sub_section-summary .content");b.loadmeta(a,
k)},setup_blogs:function(){var a=$("div.span6.section-summary a.view-in-store"),c=$('h1.header-main span[data-bind="blog.title"]');c.addClass("view-in-store").html('<a target="shopify_storeview" href="'+a.prop("href")+'">'+c.text()+"</a>").prop("title","View in store");a.remove();$("div.span6.section-summary").eq(0).find("p, h1").remove().end().append('<div class="sub_section-summary"><h1><strong>Metafields</strong> <span id="metacount">0</span></h1><div class="content"><i class="ico ico-20 ico-20-loading"></i></div></div>');
var d=$("div.sub_section-summary .content");window.setTimeout(function(){b.loadmeta(d,k)},250)},setup_rte:function(){b.data("hasbackup")&&$("#restorebackup").show();$("#clearformatting").on("click",function(){b.clearformatting();return!1});$("#createbackup").on("click",function(){b.createbackup(b.data("omega"));return!1});$("#restorebackup").on("click",function(){b.restorebackup(b.data("omega"));return!1});$("#save_images_to_meta").on("click",function(){b.save_images_to_meta();return!1})},save_images_to_meta:function(){var a=
$("iframe").contents().find("#tinymce").find("img");if(a&&a.length){var c="";a.each(function(b){var e=$(this).prop("src").replace(/https:/i,"");c+=e;b<a.length-1&&(c+=",")});$.ajax({type:"POST",url:n.URL+"/metafields.json",dataType:"json",data:{metafield:{namespace:"helpers",key:"images",value:c,value_type:"string"}},success:function(a){b.updatedropdown();b.notice("Images saved to metafield")},error:function(a){b.notice("Error saving",!0)}})}else b.notice("No images found",!0)},array_unique:function(b){b=
b.concat();for(var c=0;c<b.length;++c)for(var d=c+1;d<b.length;++d)b[c]===b[d]&&b.splice(d--,1);return b},setup_products_list:function(){if(!$("#showsku").length){var a=$("<ul/>",{"class":"segmented",id:"showsku"}),c=$("<li/>"),d=$("<a/>",{"class":"btn",href:"#",title:"Show SKU and Variant IDs"}).html("Show SKUs & ID").on("click",function(){var a=[],c=$("#all-products td.name a");c.each(function(){a.push($(this).attr("href").split(/[/]+/).pop())});if(a.length){var d=function(a,e){$.ajax({type:"GET",
url:"/admin/products/"+a[e]+".json?fields=variants",dataType:"json",success:function(p){var s=p.product.variants[0].sku;p=p.product.variants[0].id;var r="";if(s||p)s&&(r='<span title="SKU" class="sku label">'+s+"</span>"),c.eq(e).before(r+'<span title="VariantID" class="variant label">'+p+"</span>");e+1<a.length?d(a,e+1):b.fd_modal(!1)}})};b.fd_modal(!0,"Loading SKUs and Variant IDs, please wait...","Loading",!0);d(a,0)}return!1});c.append(d);a.append(c);$(".header-right .segmented").eq(1).after(a)}},
setup_link_lists_edit:function(){$.ajax({type:"GET",url:"/admin/link_lists.json",dataType:"json",success:function(a){if(a){link_lists=a.link_lists;a=0;for(var c=link_lists.length;a<c;a++)b.data("omega")}},error:function(a){b.notice("Error loading linklist data",!0)}})},setup_link_lists:function(){var a=$("div.linklist-container .box-footer"),c=function(){$.ajax({type:"GET",url:"/admin/collections.json?limit=250",dataType:"json",success:function(b){for(var a={link_list:{handle:"all-collections",title:"All Collections",
links:[]}},c=0,d=b.collections.length;c<d;++c)a.link_list.links.push({position:c+1,title:b.collections[c].title,link_type:"collection",subject_id:b.collections[c].id});f(a)},error:function(){b.notice("Error! Are you sure you have access to collections?",!0)}});return!1},d=function(){$.ajax({type:"GET",url:"/admin/pages.json?limit=250",dataType:"json",success:function(b){for(var a={link_list:{handle:"all-pages",title:"All Pages",links:[]}},c=0,d=b.pages.length;c<d;++c)a.link_list.links.push({position:c+
1,title:b.pages[c].title,link_type:"page",subject_id:b.pages[c].id});f(a)},error:function(){b.notice("Error! Are you sure you have access to pages?",!0)}});return!1},e=function(){$.ajax({type:"GET",url:"/admin/products/vendors.json",dataType:"json",success:function(b){for(var a={link_list:{handle:"all-vendors",title:"All Vendors",links:[]}},c=0,d=b.vendors.length;c<d;++c)a.link_list.links.push({position:c+1,title:b.vendors[c],link_type:"http",subject:"/collections/vendors?q="+encodeURIComponent(b.vendors[c].toLowerCase()).replace(/%20/g,
"+")});f(a)}})},f=function(a){$.ajax({type:"POST",url:"/admin/link_lists.json",data:JSON.stringify(a),contentType:"application/json;charset=utf-8",dataType:"json",success:function(a){b.notice("Link list added")}})},h=$("<a/>",{href:"#","class":"btn btn-slim fr",style:"margin-right:.5em"}).text("Copy").on("click",function(){var b=$(this).parent().find('a[data-route="link_list"]').eq(0);b.length&&(href=b.attr("href").split("/").pop(),isNaN(href)||$.ajax({type:"GET",url:"/admin/link_lists/"+href+".json",
dataType:"json",success:function(b){delete b.link_list.id;delete b.link_list["default"];b.link_list.title+=" COPY";b.link_list.handle+="-copy";f(b)}}));return!1});a.append(h);var a=$(".span6.section-summary").eq(0),h=$("<a/>",{"class":"btn",href:"#",title:"Create a linklist with every collection"}).text("Create Collections linklist").on("click",function(){c();return!1}),g=$("<a/>",{"class":"btn",href:"#",title:"Create a linklist with every page"}).text("Create Pages linklist").on("click",function(){d();
return!1}),l=$("<a/>",{"class":"btn",href:"#",title:"Create a linklist with all vendors"}).text("Create Vendor linklist").on("click",function(){e();return!1}),p=$("<p/>",{"class":"box warning",style:"margin-top:1em"}).text("If you use the trash can button to remove a linklist some ShopifyFD features will not reload. Navigate away from the page, and back again.");a&&a.append("<br><br>",h,"<br><br>",g,"<br><br>",l).find("p:eq(0)").append(p)},setup_collections:function(){b.data("collections",!1);var a=
$("<ul/>",{"class":"segmented"}),c=$("<li/>"),d=$("<a/>",{"class":"btn",href:"#",title:"Add tags to entire collection"}).html("Bulk edit tags").on("click",function(){b.fd_modal(!0,'<div><div class="clearfix em"><div class="half">Choose a collection</div><div class="half"><select data-action="collection"><option value="">Loading, please wait...</option></select></div></div><div class="clearfix em"><div class="half">Choose an action</div><div class="half"><select data-action="action"><option value="add">Add</option><option value="set">Set</option><option value="remove">Remove</option><option disabled value="toggle">Toggle</option><option value="purge" style="background:red;color:#fff">DELETE ALL</option></select></div></div><div class="clearfix em"><div class="half">Set the tag</div><div class="half"><input /></div></div><div class="half"><a class="btn" data-action="update_tags">Update tags</a></div><div class="half"><small>Add: Adds tags to the existing ones<br>Set: Replaces tags with new ones<br>Remove: Removes matching tags<br>Toggle: Future Use, disabled...</small></div></div>',
"Edit tags for all products in a collection",!0);var a=$("#fdmodal"),c=a.find('select[data-action="action"]'),d=a.find("a").eq(1),g=a.find('select[data-action="collection"]'),l=a.find("input").eq(0);c.change(function(b){"purge"==c.val()||"set"==c.val()?("purge"==c.val()&&l.val("").attr("disabled","disabled"),d.addClass("delete")):(l.removeAttr("disabled"),d.removeClass("delete"))});var p=function(b,a,c,e){var f=b.products[a].id,g={product:{id:f,tags:c}};d.text(a+1+"/"+b.products.length);$.ajax({type:"PUT",
url:"/admin/products/"+f+".json",data:g,dataType:"json",success:function(d){++a;a<b.products.length?p(b,a,c,e):e()}})},s=function(b,a,c,e){if(b.products[a].tags){var f=c.replace(/, /g,",").split(","),g=b.products[a].tags.replace(/, /g,",").split(","),g=$(g).not(f).get()+"",f=b.products[a].id,g={product:{id:f,tags:g}};d.text(a+1+"/"+b.products.length);$.ajax({type:"PUT",url:"/admin/products/"+f+".json",data:g,dataType:"json",success:function(d){++a;a<b.products.length?s(b,a,c,e):e()}})}else++a,a<b.products.length?
s(b,a,c,e):e()},r=function(a,c,e,f){var g=e.replace(/, /g,",").split(","),l=a.products[c].tags.split(","),l=b.array_unique(g.concat(l))+"",g=a.products[c].id,l={product:{id:g,tags:l}};d.text(c+1+"/"+a.products.length);$.ajax({type:"PUT",url:"/admin/products/"+g+".json",data:l,dataType:"json",success:function(b){++c;c<a.products.length?r(a,c,e,f):f()}})};d.on("click",function(){g.val().length?("add"==c.val()&&l.val().length&&$.ajax({type:"GET",url:"/admin/products.json?collection_id="+g.val()+"&fields=id,tags",
dataType:"json",success:function(a){d.addClass("disabled");r(a,0,l.val(),function(){b.notice("Done. Tags have been added");d.text("Update tags").removeClass("disabled")})}}),"purge"!=c.val()&&"set"!=c.val()||$.ajax({type:"GET",url:"/admin/products.json?collection_id="+g.val()+"&fields=id",dataType:"json",success:function(a){d.addClass("disabled");p(a,0,l.val(),function(){b.notice("Done.");d.text("Update tags").removeClass("disabled")})}}),"remove"==c.val()&&$.ajax({type:"GET",url:"/admin/products.json?collection_id="+
g.val()+"&fields=id,tags",dataType:"json",success:function(a){d.addClass("disabled");s(a,0,l.val(),function(){b.notice("Matched tags have been removed.");d.text("Update tags").removeClass("disabled")})}})):b.notice("Choose a collection",!0);return!1});c.hide();$.ajax({type:"GET",url:"/admin/collections.json",dataType:"json",success:function(a){if(a.collections.length){b.data("collections",a);for(var d="",e=0,h=a.collections.length;e<h;e++)d+='<option value="'+a.collections[e].id+'">'+a.collections[e].title+
"</option>";g.append(d).find("option:eq(0)").text("Select a collection");c.show()}}});return!1});c.append(d);a.append(c);$(".header-right .segmented").eq(1).after(a)},setup_copypaste:function(){var a=$('<div><a class="hidden btn btn-slim" id="fd_copymetafields">Copy Metafields</a> <a class="btn btn-slim" id="fd_pastemetafields">Paste Metafields</a> <a class="btn btn-slim" title="What have I copied?" href="#" id="fd_whatmetafields">?</a></div>'),c=a.find("#fd_pastemetafields"),d=a.find("#fd_whatmetafields");
a.find("#fd_copymetafields").on("click",function(){b.data("m")?(b.data("m-copy",b.data("m")),b.notice(b.data("m-copy").length+" Metafields copied"),c.show(),d.show()):(c.hide(),d.hide());return!1});d.on("click",function(){if(b.data("m-copy")){for(var a="",c=b.data("m-copy"),d=0,g=c.length;d<g;d++)a+="<p><strong>"+c[d].namespace+"."+c[d].key+" ("+c[d].value_type+")</strong><br>"+c[d].value+"</p><hr>";b.fd_modal(!0,a,"In the virtual clipboard...")}return!1});c.on("click",function(){b.data("m-copy")&&
b.save_metafield_queue(b.data("m-copy"),0);return!1});b.data("m-copy")||(c.hide(),d.hide());$("div.sub_section-summary").after(a)},save_metafield_queue:function(a,c){b.fd_modal(!0,"","Please wait whilst we past the metafields",!0);$.ajax({type:"POST",url:n.URL+"/metafields.json",dataType:"json",data:{metafield:{namespace:a[c].namespace,key:a[c].key,value:a[c].value,value_type:a[c].value_type}},success:function(d){c+1<a.length?b.save_metafield_queue(a,c+1):(b.updatedropdown(),b.fd_modal(!1),b.notice("Pasted!"))}})},
setup_products:function(){clearInterval(b.data("autosave"));$.ajax({type:"GET",url:"/admin/products.json?limit=25",dataType:"json",success:function(a){if(a&&(products=a.products,a=products.length,25>=a))for(var c=0;c<a;c++)b.data("omega")},error:function(a){b.notice("Error loading linklist data",!0)}});var a=$("div.span6.section-summary").eq(0),c=a.find("a").eq(0).attr("href");a.html("").append('<div class="sub_section-summary"><h1><strong>Metafields</strong> <span id="metacount">0</span></h1><div class="content"><i class="ico ico-20 ico-20-loading"></i></div></div>');
0==$("#rte_extra").length?($("#product-description_iframecontainer").eq(0).after('<div id="rte_extra"><a class="btn btn-slim" title="Careful, this method is brutal..." id="clearformatting" href="#">Purge html</a> <a class="btn btn-slim" id="createbackup" href="#">Create Backup</a> <a class="btn btn-slim" style="display:none;" id="restorebackup" href="#">Restore Backup</a> <a class="btn btn-slim" title="Add any images in the description to a Metafield" id="save_images_to_meta" href="#">Images to Metafields</a></div>'),
$(".rtetools-buttons ul.fr").eq(1).append('<li><a id="autosave" tabindex="-1" class="btn btn-slim tooltip tooltip-bottom" href="#"><span class="tooltip-container"><span class="tooltip-label">Enable Autosave</span></span>Autosave</a></li>'),b.setup_rte(),$("#autosave").on("click",function(){var a=!1;$(this).hasClass("rte-command-active")?(b.notice("Autosave disabled"),clearInterval(b.data("autosave"))):(a=$('#products-show header input[type="submit"]'),b.notice("Autosave enabled"),b.data("autosave",
setInterval(function(){a.length?a.click():(clearInterval(b.data("autosave")),a=null,b.notice("Autosave disabled"))},3E4)));$(this).toggleClass("rte-command-active");return!1})):b.notice("Bug! I tried to load the content editor twice.",!0);b.btn_removealltags();var a=$("h1.header-main"),d=$("div.sub_section-summary .content"),c=$("<a />",{href:c,target:"_blank",style:"display: inline-block;vertical-align: top;",title:"View in Store"});c.append('<i class="ico ico-20-svg ico-sidebar-bottom-website"></i>');
a.append(c);b.loadmeta(d,k);$("#product-inner-variants th:last-child").before("<th>Variant ID</th>");$("th.inventory.tc").text("#").prop("title","Quantity");$("tr.variant").each(function(b){b=$("td.sku input.mock-edit-on-hover").eq(b).prop("id").split(/[- ]+/).pop();$(this).find("td:last-child").before('<td class="vid tooltip tooltip-bottom"><input class="mock-edit-on-hover" data-action="selectall" data-val="'+b+'" type="text" value="'+b+'" /><span class="tooltip-container"><span class="tooltip-label">Click to edit Metafields</span></span></td>')}).promise().done(function(){b.panel_editvariantmeta()});
$("table.product-collections").eq(0).find("tr").each(function(){var a=$("<a/>",{"class":"btn",href:"#",title:"Set a metafield with this collection handle"}).text("Set as preferred").on("click",function(){b.fd_modal(!0,"soon...","Future function");return!1});$(this).find("td.col-remove").prepend(a)});c=$("table.variants .bulk-actions").eq(0);if(c.length){var e=$("<a/>",{href:"#","class":"btn btn-slim hidden",style:"padding-left:.5em"}).text("Edit weight").on("click",function(){b.fd_modal(!0,'<label>New weight (grams)</label><input class="half" min="0" type="number" data-action="update-variant-weight" /><a data-action="update-variant-weight" href="#" class="btn btn-slim">Save</a><br><br><small>Note: You will need to reload this page before Shopify will show the new weight in the dashboard.</small>',
"Edit weight",!0);var a=$('a[data-action="update-variant-weight"]'),c=$('input[data-action="update-variant-weight"]');if(a.length&&c.length)a.on("click",function(){var d=$('tr.variant input[type="checkbox"]:checked');if(d.length&&!isNaN(c.val())){var e=[];d.each(function(){var b=$(this).parent().parent().find("td.vid").text();isNaN(b)||e.push(parseInt(b))});var f=function(d,e){$.ajax({type:"PUT",url:"/admin/variants/"+e[d],dataType:"json",data:{variant:{id:e[0],grams:c.val()}},success:function(c){++d;
d<e.length?f(d,e):(b.notice("Weight updated"),a.removeClass("is-loading").text("Save"))}})};a.addClass("is-loading").text("");f(0,e)}else b.notice("Did you set a weight?",!0);return!1});return!1});$("<span/>",{"class":"hidden"});var f=$("<a/>",{href:"#","class":"btn btn-slim hidden",style:"padding-left:.5em"}).text("Edit metafields").on("click",function(){$('tr.variant input[type="checkbox"]:checked').eq(0).parent().parent().find("td.vid").click();return!1});c.append(e,f);$('tr.variant input[type="checkbox"]').on("change",
function(){var b=$('tr.variant input[type="checkbox"]:checked').length;1<b?(e.removeClass("hidden"),f.addClass("hidden")):(e.addClass("hidden"),1===b?f.removeClass("hidden"):f.addClass("hidden"))})}},setup_pages:function(){var a=$("div.span6.section-summary").eq(0),c=$("h1.header-main"),d=a.find("a").eq(0).attr("href"),d=$("<a />",{href:d,target:"_blank",style:"display: inline-block;vertical-align: top;",title:"View in Store"});d.append('<i class="ico ico-20-svg ico-sidebar-bottom-website"></i>');
c.append(d);$("#page-content_ifr").eq(0).after('<div id="rte_extra"><a class="btn btn-slim" title="Careful, this method is brutal..." id="clearformatting" href="#">Purge html</a> <a class="btn btn-slim" id="createbackup" href="#">Create Backup</a> <a class="btn btn-slim" style="display:none;" id="restorebackup" href="#">Restore Backup</a> <a class="btn btn-slim" title="Add any images in the description to a Metafield" id="save_images_to_meta" href="#">Images to Metafields</a></div>');b.setup_rte();
a.html("").append('<div class="sub_section-summary"><h1><strong>Metafields</strong> <span id="metacount">0</span></h1><div class="content"><i class="ico ico-20 ico-20-loading"></i></div></div>');a=$("div.sub_section-summary .content");b.loadmeta(a,k)},shipping_remove_all:function(a,c){0<=a?$.ajax({type:"DELETE",url:"/admin/countries/"+c[a].id+".json",dataType:"json",success:function(d){b.notice("removed "+c[a].name);a-=1;b.shipping_remove_all(a,c)}}):$.ajax({url:"/admin/settings/shipping",success:function(){$("div.shipping-rate-table").remove()}})},
save_new_rates:function(a,c,d){if(a[c]){var e=a[c],f={},h=e.type,g="";delete e.type;h?("weight"===h?(f={weight_based_shipping_rate:{}},f.weight_based_shipping_rate=e,g="/admin/weight_based_shipping_rates.json"):"price"===h?(f={price_based_shipping_rate:{}},f.price_based_shipping_rate=e,g="/admin/price_based_shipping_rates.json"):"carrier"===h&&(f={carrier_shipping_rate_provider:{}},f.carrier_shipping_rate_provider=e,g="/admin/carrier_shipping_rate_providers.json"),$.ajax({type:"POST",url:g,dataType:"json",
data:f,success:function(e){d.parent().parent().find("table").append('<tbody><tr style="background:#efefef"><td>'+a[c].name+'</td><td>Pasted a custom shipping rate. <a href=".">Refresh page</a> to view</td><td>'+a[c].price+"</td></tr></tbody>");c===a.length-1?b.notice("Paste complete"):(c++,b.save_new_rates(a,c,d))}})):b.notice("missing type: "+h,!0)}else b.notice("save_new_rates error - length",!0)},setup_shipping:function(a){if(a){b.fd_modal(!1);$("div.span6.section-summary").eq(0).append('<p style="margin-top:1em" class="box warning">Warning: When you copy and paste over existing rates the old ones still show until the page is refreshed, even though they have been removed. <br><br>Be sure to do a test first. <strong>Use at own risk.</strong></p>');
a=$("#settings-shipping");var c=$('<div class="header-right"><div class="header-action"><ul class="segmented"><li><a class="btn" href="#">Bulk Updates</a></li><li><a class="btn delete btn-separate" href="#">Delete all countries</a></li></ul></div></div>');c.find("a").eq(0).on("click",function(){var a=$('<h2 class="warning"><strong>Warning:</strong> This section can make bulk changes to your Shipping rates. There is no undo.</h2><div><div class="span1"><p>Soon...</p></div><div class="span2"><p>Do note that once you run this you are going to have to manually refresh to see the updates. Annoying I know, but I have not found a way around this...</p></div></div>');
b.fd_modal(!0,a,"Bulk Updates",!0);return!1}).hide();c.find("a").eq(1).on("click",function(){var a=$('<h2 class="warning"><strong>Warning:</strong> This is a bad idea. It will delete ALL of your countries. There is no undo. Proceed at own risk!</h2><div><div class="span1"><a href="#" class="btn delete_all delete">Delete</a></div><div class="span2"><p>Do note that once you run this you are going to have to manually refresh to see the updates. Annoying I know, but I have not found a way around this...</p></div></div>');
a.find("a.delete_all").on("click",function(){$.ajax({type:"GET",url:"/admin/countries.json",dataType:"json",success:function(a){a.countries.length&&(k.countries=a.countries,b.notice(a.countries.length+" countries returned"),b.shipping_remove_all(a.countries.length-1,a.countries))}});return!1});b.fd_modal(!0,a,"Delete all countries",!0);return!1});a.find("header").eq(0).append(c);if($("div.shipping-rate-table").length===b.data("countries").countries.length){var d=[],e=[],f=[],h=function(a,c,d){if(c.length){var e=
[];$.ajax({type:"GET",url:"/admin/countries/"+a+".json",dataType:"json",success:function(a){var f=a.country.weight_based_shipping_rates,g=a.country.price_based_shipping_rates,h=a.country.carrier_shipping_rate_providers;a=0;for(var k=f.length;a<k;a++)e.push([f[a].id,"weight"]);a=0;for(k=g.length;a<k;a++)e.push([g[a].id,"price"]);a=0;for(k=h.length;a<k;a++)e.push([h[a].id,"carrier"]);a=0;for(k=e.length;a<k;a++)f="","weight"==e[a][1]&&(f="/admin/weight_based_shipping_rates/"),"price"==e[a][1]&&(f="/admin/price_based_shipping_rates/"),
"carrier"==e[a][1]&&(f="/admin/carrier_shipping_rate_providers/"),$.ajax({type:"DELETE",url:f+e[a][0]+".json",dataType:"json",success:function(b){}});b.save_new_rates(c,0,d)},fail:function(){b.notice("I failed to get the country.json",!0)}})}else b.notice("Missing items to add",!0)};$("div.shipping-rate-table").each(function(a){var c=$(this),p=$("<a/>",{href:"#","data-country":b.data("countries").countries[a].name,"data-cid":b.data("countries").countries[a].id,"data-index":a,"class":"btn btn-slim copyrates",
style:"float:right;margin-right:.5em"}).text("Copy rates").on("click",function(){var a=$(this);a.attr("data-index");var c=a.attr("data-country"),a=a.attr("data-cid");$("a.bulkpaste").hide();$.ajax({type:"GET",url:"/admin/countries/"+a+".json",dataType:"json",success:function(a){d=a.country.weight_based_shipping_rates;e=a.country.price_based_shipping_rates;f=a.country.carrier_shipping_rate_providers;b.notice("Copy of "+c+" ready");$("a.bulkpaste").show()}});return!1});a=$("<a/>",{href:"#","data-country":b.data("countries").countries[a].name,
"data-cid":b.data("countries").countries[a].id,"data-index":a,"class":"bulkpaste btn btn-slim",style:"float:right;margin-right:.5em"}).text("Paste rates").on("click",function(){var b=$(this),a=b.attr("data-cid"),c=d,g=e,l=f,p=[],k=0;b.parent().parent().find("tbody").remove();b.parent().find("a.copyrates").remove();for(var q=0,n=c.length;q<n;q++)c[q].country_id=a,delete c[q].id,c[q].type="weight",p[k]=c[q],k++;q=0;for(n=g.length;q<n;q++)g[q].country_id=a,delete g[q].id,g[q].type="price",p[k]=g[q],
k++;q=0;for(n=l.length;q<n;q++)l[q].country_id=a,delete l[q].id,l[q].type="carrier",p[k]=l[q],k++;h(a,p,b);return!1}).hide();c.find('a[data-event-click="setupNewShippingRateForm"]').after(a,p)})}else b.notice("Mismatch in country count. Reload this page.",!0)}else $.ajax({type:"GET",url:"/admin/countries.json",dataType:"json",success:function(a){a.countries.length&&(b.data("countries",a),b.notice(a.countries.length+" countries loaded"),b.setup_shipping(!0))}})},setup_custom_collections:function(){$("div.row.section.visibility").eq(0).after('<div class="row section" id="customer_meta_box"><div class="span12 section-summary"><div class="sub_section-summary"><h1><strong>Metafields</strong> <span id="metacount">0</span></h1><div class="content"><i class="ico ico-20 ico-20-loading"></i></div></div></div></div>');
var a=$("div.sub_section-summary .content");b.loadmeta(a,k);0===$("#rte_extra").length&&($("#collection-description_iframecontainer").eq(0).after('<div id="rte_extra"><a class="btn btn-slim" title="Careful, this method is brutal..." id="clearformatting" href="#">Purge html</a> <a class="btn btn-slim" id="createbackup" href="#">Create Backup</a> <a class="btn btn-slim" style="display:none;" id="restorebackup" href="#">Restore Backup</a> <a class="btn btn-slim" title="Add any images in the description to a Metafield" id="save_images_to_meta" href="#">Images to Metafields</a></div>'),
b.setup_rte())},get_files:function(a,c){var d=$("#settings-general table");b.notice("Loading files...");$.ajax({type:"GET",url:"/admin/files.json?limit=50&direction=next&page="+a,success:function(a,f,h){if(a){$("");f=0;for(h=a.files.length;f<h;f++){var g=$("<tr />",{"class":"file_row"}),l=$("<td />"),p=$("<td />"),k=$("<td />"),r=$("<td />",{"class":"tr"}),n=$("<td />"),u=$("<a />",{href:"#","data-src":a.files[f].public_url.replace("http:","")});if(-1<a.files[f].content_type.indexOf("image")){u.on("click",
function(){var a=$(this);b.fd_modal(!0,'<img src="'+a.attr("data-src")+'" />',"Image Preview",!0);return!1}).text(a.files[f].key.replace("files/",""));var t=a.files[f].public_url.replace(/(\.[^\.]+)$/,"_thumb$1").replace("http:","");l.html('<img src="'+t+'" />');p.append(u);k.html('<input class="select-all-on-focus" value="'+a.files[f].public_url+'">')}else u.attr("href",a.files[f].public_url).attr("target","_blank").text(a.files[f].key.replace("files/",""));r.html(Math.floor(a.files[f].size/1024)+
" kB");g.append(l,p,k,r,n);d.append(g)}f>=c?(b.notice("All loaded"),$(".header-right .segmented").hide()):(++f,b.get_files(f,c))}}})},setup_files:function(){var a=$("<ul/>",{"class":"segmented",id:"get_all_images"}),c=$("<li/>"),d=$("<a/>",{"class":"btn",href:"#",style:"margin-left:1em"}).html("Show all files").on("click",function(){var a=$(this);a.addClass("is-loading").attr("style","margin-left:1em;text-indent: -9999px;");$.ajax({type:"GET",url:"/admin/files.json?limit=2&fields=id",success:function(a,
c,d){a&&(a=d.getResponseHeader("X-Total-Results"),50<a?(a=Math.ceil(a/50),b.get_files(2,a)):b.notice("There are no more to load",!0))},error:function(){a.removeClass("is-loading").attr("style","margin-left:1em");b.notice("Error loading files",!0)}});return!1});c.append(d);a.append(c);$(".header-right .segmented").eq(0).after(a);$("#settings-general .info-message").prepend('<p class="box notice"><b>Bulk file deletion is coming soon to ShopifyFD...</b></p>')},setup_settings_general:function(){var a=
$("<div>",{id:"general_metafields","class":"row section description"}),c=$("<div>",{"class":"span6 section-summary"}),d=$("<div>",{"class":"span18 section-content"});c.html("<h1>Store Metafields</h1><p>Edit your most awesome shop level metafields here...</p>");d.html('<div class="sub_section-summary"><h1><strong>Metafields</strong> <span id="metacount">0</span></h1><div class="content"><i class="ico ico-20 ico-20-loading"></i></div></div>');a.append(c).append(d);$("div.row.section.description.first-section").eq(0).after(a);
a=$("div.sub_section-summary .content");b.loadmeta(a,k)},setup_customers:function(){$("section.customer-details.ssb .box-details").eq(0).after('<div id="customer_meta_box" class="box box-details"><div class="box-header p"><h3>Metafields</h3></div><div class="box-content p"><div class="sub_section-summary"><h1><strong>Metafields</strong> <span id="metacount">0</span></h1><div class="content"><i class="ico ico-20 ico-20-loading"></i></div></div></div>');var a=$("div.sub_section-summary .content");b.loadmeta(a,
k)},setup_single_order:function(){$("div.order-sidebar .box-details").eq(0).after('<div id="customer_meta_box" class="box box-details"><div class="box-header p"><h3>Metafields</h3></div><div class="box-content p"><div class="sub_section-summary"><h1><strong>Metafields</strong> <span id="metacount">0</span></h1><div class="content"><i class="ico ico-20 ico-20-loading"></i></div></div></div>');var a=$("div.sub_section-summary .content");b.loadmeta(a,k);var a=$('div.address[data-showif="order.billing_address"]').eq(0),
c=a.find('a[data-modal-view="ContactCustomerModalView"]'),c=$("<input />",{value:c.text(),"class":"noprint",style:"margin-top:1em"}).on("click",function(){$(this).select()});a.append(c)},setup_orders:function(){var a=$("<ul/>",{"class":"segmented",id:"get_email_list"}),c=$("<li/>"),d=$("<a/>",{"class":"btn",href:"#"}).html("Get emails").on("click",function(){var a=$('<table><tr><td>How many days back do we search?</td><td><input value="30" id="from_recent_order_id" placeholder="days" type="text" /></td></tr><tr><td>Fulfillment Status</td><td><select id="recent_fulfillment_status"><option value="any">Any</option><option value="partial">Partial</option><option value="unshipped">Unshipped</option><option value="shipped">Shipped</option></select></td></tr><tr><td><a class="btn getdata">Get Emails</a></td><small>For now this grabs the email only and adds it to the box below. If you would like to see this work differently - let me know!</small><td></td></tr></table><textarea id="recent_emails_output" class="debug" placeholder="Email addresses will load here..."></textarea>');
a.find("a.getdata").on("click",function(){var a=$("#recent_emails_output"),c=new Date,d=30,e=$("#from_recent_order_id").val(),f=$("#recent_fulfillment_status").val();a.val("");0<e.length&&(d=parseInt(e));c.setDate(c.getDate()-d);d=c.getDate();e=c.getMonth()+1;d=c.getFullYear()+"-"+(9>=e?"0"+e:e)+"-"+(9>=d?"0"+d:d)+" 00:00";b.flog(c);b.flog(d);$.ajax({type:"GET",url:"/admin/orders.json?fields=email&fulfillment_status="+f+"&created_at_min="+d,success:function(c){if(c.orders.length){c=c.orders;for(var d=
"",e=0,f=c.length;e<f;e++)b.flog(c[e].email),d+=c[e].email+",\n";a.val(d)}else b.notice("Error. No results returned",!0)}})});b.fd_modal(!0,a,"Get recent order emails",!0);return!1});c.append(d);a.append(c);$(".header-right .segmented").eq(1).after(a);var e=!1;$('#all-orders a[data-bind="order.name"]').append('<div class="bubble ssb hide" style="bottom: 5px;"><div class="bubble-content p"><h3 class="large">Orders</h3><div class="fl pr"><ul class="unstyled"></ul></div></div><footer class="bubble-footer"><div class="bubble-arrow-wrap"><span class="bubble-arrow-border"></span><span class="bubble-arrow"></span></div></footer></div>').css({position:"relative"}).hover(function(){var a=
$(this);e=setTimeout(function(){var b=a.find("ul").eq(0),c=a.attr("href");$("div.bubble").addClass("hide");a.data("order")?a.find("div.bubble").removeClass("hide"):$.ajax({type:"GET",url:c+".json",success:function(c){if(c){for(var d=c.order.line_items,e=c.order.fulfillments,g="",k=0,n=d.length;k<n;k++)g+='<li style="white-space:normal">'+d[k].quantity+" x "+d[k].name+"</li>";c.order.fulfillment_status&&e.length&&(g+='<li style="white-space:normal;border-top: 1px solid #ccc;margin-top: .5em;padding-top: .5em;">Tracking#: <b>'+
e[0].tracking_number+"</b></li>");a.data("order",g);b.html(g);a.find("div.bubble").removeClass("hide")}}})},200)},function(){clearTimeout(e);$(this).find("div.bubble").addClass("hide")})},get_recent_emails:function(a){},shortcut_to_open_orders:function(){$('#sidebar span[data-bind="Order.openCount"]').on("click",function(){b.redirect("/orders?query=+financial_status%3Aany+status%3Aopen")}).prop("title","Jump to open orders")},updatedropdown:function(){var a=n.URL+"/metafields.json";"general"===b.data("omega")&&
(a="/admin/metafields.json");"articles"===b.data("alpha")&&(a="/admin/articles/"+b.data("omega")+"/metafields.json");$.getJSON(a,function(a){var d="";a=a.metafields;if(a.length){b.data("m",a);$("#metacount").text(a.length).addClass("active");for(var e=0,f=a.length;e<f;e++)d+='<option data-type="'+a[e].value_type+'" data-id="'+a[e].id+'">'+a[e].namespace+"."+a[e].key+"</option>",k.metafields[a[e].id]={namespace:a[e].namespace,value:a[e].value,key:a[e].key},"backups"==a[e].namespace&&$("#restorebackup").show();
d='<option value="">Select or create a metafield</option>'+d}else $("#metacount").text("0").removeClass("active"),b.data("m",!1),$("#restorebackup").hide(),d='<option value="">Select or create a metafield</option>';$("#metafieldselect").html(d);b.clearmetaform()})},load_css:function(){var a=document.createElement("link");a.type="text/css";a.rel="stylesheet";a.id="shopifyjs";a.href="//rawgithub.com/freakdesign/shopifyFD/master/shopifyFD.css";document.body.appendChild(a)},get_theme_data:function(){b.data("themeID")||
$.ajax({type:"GET",url:"/admin/themes.json",success:function(a){if(a)for(var c=0,d=a.themes.length;c<d;c++)"main"===a.themes[c].role&&(b.flog(a.themes[c].id),b.data("themeID",a.themes[c].id),b.data("themeName",a.themes[c].name))}})},init:function(){b.set_drag_drop();b.get_theme_data();b.data("debug")||b.readCookie("shopifyfd")||(b.flash_notification(),b.createCookie("shopifyfd","loaded",3));$("html").addClass("shopifyJSoverride");setInterval(function(){if(!b.data("content").hasClass("loading")){var a=
n.URL.split("#")[0].split("?")[0].split("/"),a=a[a.length-2],c=n.URL.split("/").pop();if(a!==b.data("alpha")||c!==b.data("omega"))b.data("alpha",a),b.data("omega",c),b.flog(b.data("alpha")+","+b.data("omega")),"customers"!=b.data("alpha")||isNaN(b.data("omega"))?"articles"!=b.data("alpha")||isNaN(b.data("omega"))?"pages"!=b.data("alpha")||isNaN(b.data("omega"))?"smart_collections"!==b.data("alpha")||isNaN(b.data("omega"))?"custom_collections"!==b.data("alpha")||isNaN(b.data("omega"))?"collections"!==
b.data("alpha")||isNaN(b.data("omega"))?"blogs"!=b.data("alpha")||isNaN(b.data("omega"))?"products"==b.data("alpha")?b.setup_products():"admin"==b.data("alpha")&&"products"==b.data("omega")?b.setup_products_list():"orders"!=b.data("alpha")||isNaN(b.data("omega"))?"admin"==b.data("alpha")&&"orders"==b.data("omega")?b.setup_orders():"admin"==b.data("alpha")&&"collections"==b.data("omega")?b.setup_collections():"admin"==b.data("alpha")&&"link_lists"==b.data("omega")?b.setup_link_lists():"admin"==b.data("alpha")&&
"links"==b.data("omega")?b.setup_link_lists():"link_lists"!=b.data("alpha")||isNaN(b.data("omega"))?"admin"==b.data("alpha")&&"discounts"==b.data("omega")?b.setup_discounts():"settings"==b.data("alpha")&&"general"==b.data("omega")?b.setup_settings_general():"settings"==b.data("alpha")&&"files"==b.data("omega")?b.setup_files():"settings"==b.data("alpha")&&"shipping"==b.data("omega")?b.setup_shipping():"settings"==b.data("alpha")&&b.data("omega"):b.setup_link_lists_edit():b.setup_single_order():b.setup_blogs():
b.setup_custom_collections():b.setup_custom_collections():b.setup_custom_collections():b.setup_pages():b.setup_articles():b.setup_customers()}},b.data("wait"))},data:function(a,b){if("undefined"===typeof b)return k[a];k[a]=b},toggleStyle:function(){$("html").toggleClass("shopifyJSoverride")},isloading:function(){return b.data("content").hasClass("loading")}}}();b.load_css();var x=$("body"),t=$("<div>",{id:"shopifyJSbar","class":"loading noprint"}),w=$("<div>",{"class":"wrapper clearfix"}),v=$("<ul>",
{id:"shopifyJSnav"});v.html('<li><a title="About this tool" id="aboutapp" href="javascript:void(0)">About ShopifyFD</a></li><li><a title="View recent news" id="getnotifications" href="javascript:void(0)"><i style="background-size: contain;" class="ico ico-16 ico-sidebar-bottom-announcements-inactive"></i></a></li><li><a id="togglestyle" href="javascript:void(0)">Toggle CSS</a></li>\x3c!--<li><a id="themesettings" href="javascript:void(0)">Theme Settings</a></li><li><a id="manageinventory" href="javascript:void(0)">Manage Inventory</a></li>--\x3e<li><a id="bulkmetafields" href="javascript:void(0)">Bulk Metafields</a></li><li><a href="//freakdesign-us.s3.amazonaws.com/shopify/shopifyFD/freakdesign-shopifyfd-for-shopify-guide.pdf" target="_blank">Help</a></li><li><a title="This tool is free, consider leaving a tip" href="http://shopify.freakdesign.com.au/#donate" target="_blank">Use this free tool? Tip me! ($)</a></li>');
v.find("a").on("click",function(){if(b.isloading())b.notice("We better wait for this page to load first...",!0);else{var k=$(this),a=k.prop("id");if(a){if("manageinventory"!=a||"inventory"===b.data("alpha"))"bulkmetafields"==a?b.bulkmetafields():"themesettings"==a&&isNaN(b.data("alpha"))?b.redirect("/themes/current/settings"):"togglestyle"==a?(b.toggleStyle(),k.toggleClass("active")):"aboutapp"==a?b.about_app():"getnotifications"==a&&b.show_notification()}else return!0}return!1});w.append(v);t.append(w);
x.append(t);t.removeClass("loading");b.notice("ShopifyFD loaded");b.init()}else alert("Error. This should be run within the Shopify Admin page.")}else alert("Error. jQuery not found.")})();