!function(){if("undefined"!=typeof Shopify)if("undefined"!=typeof jQuery)if($("#shopifyjs").length)"function"==typeof Shopify.Flash.error&&Shopify.Flash.error("Error. ShopifyFD already loaded!");else{var e=document,t=e.URL;if(t.indexOf("myshopify.com/admin")>1){var a="Save",i="Delete",n="javascript:void(0)",s='<label style="margin-top:1em">Add New Metafield</label><input class="ssb" maxlength="20" type="text" id="metafield_namespace" placeholder="namespace"><input class="ssb" maxlength="30" type="text" id="metafield_key" placeholder="key"><textarea class="ssb" id="metafield_value" placeholder="value"></textarea><input type="hidden" id="metafield_id"><a class="btn btn-slim savemymeta" id="shopifyjs_savemetafield">'+a+'</a> <a class="int btn btn-slim savemymeta" id="shopifyjs_savemetafield_int">Save as Integer</a> <a class="btn btn-slim hidden delete" id="shopifyjs_deletemetafield">'+i+'</a><p style="margin-top:1em;line-height:1"><small><a id="advanced_meta_features" href="'+n+'">Toggle advanced features</a><br>Please note: Using the save button top right will NOT save these metafields. Be sure to click '+a+' above.</small></p><div id="advanced_meta" class="hidden"><p><a class="btn btn-slim hidden" data-action="convert_mf_type">Convert type</a></p><p style="border-bottom: 1px solid #ccc;">Handle Helper <a id="adv_clear_cache" style="float:right" href="'+n+'">Clear cache</a></p><p><a id="adv_get_collections" class="btn btn-slim" href="">Get collections</a></p><p><a id="adv_get_products" class="btn btn-slim" href="">Get products</a> <small>not suitable for large stores</small></p></div>',l='<div class="sub_section-summary"><h1><strong>Metafields</strong> <span id="metacount">0</span></h1><div class="content"><i class="ico ico-20 ico-20-loading"></i></div></div>',r='<option value="">Select or create a metafield</option>',d='<div><a class="btn btn-slim" id="fd_copymetafields">Copy Metafields</a> <a class="btn btn-slim" id="fd_pastemetafields">Paste Metafields</a> <a class="btn btn-slim" title="What have I copied?" href="#" id="fd_whatmetafields">?</a></div>',c='<div id="rte_extra"><a class="btn btn-slim" title="Careful, this method is brutal..." id="clearformatting" href="#">Purge html</a> <a class="btn btn-slim" id="createbackup" href="#">Create Backup</a> <a class="btn btn-slim" style="display:none;" id="restorebackup" href="#">Restore Backup</a> <a class="btn btn-slim" title="Add any images in the description to a Metafield" id="save_images_to_meta" href="#">Images to Metafields</a></div>',p='<div class="vbox"><fieldset><select>'+r+'</select><input id="mv_namespace" placeholder="namespace" /><input id="mv_key" placeholder="key" /><input id="mv_value" placeholder="value" /></fieldset><span class="mybuttons"><a class="save btn btn-slim" href="#">'+a+'</a> <a class="btn btn-slim saveinteger" href="#">'+a+' as Integer</a> <a title="Delete" class="delete ico ico-16 ico-delete" href="#">delete</a></span></div>',u='<li><a title="About this tool" id="aboutapp" href="'+n+'">About ShopifyFD</a></li><li><a title="View recent news" id="getnotifications" href="'+n+'"><i class="ico ico-16 ico-announcements-inactive"></i></a></li><li><a id="togglestyle" href="'+n+'">Toggle CSS</a></li><li><a id="themesettings" href="'+n+'">Theme Settings</a></li><li><a id="manageinventory" href="'+n+'">Manage Inventory</a></li><li><a id="bulkmetafields" href="'+n+'">Bulk Metafields</a></li><li><a href="//freakdesign-us.s3.amazonaws.com/shopify/shopifyFD/freakdesign-shopifyfd-for-shopify-guide.pdf" target="_blank">Help</a></li><li><a title="This tool is free, consider leaving a tip" href="http://shopify.freakdesign.com.au/#donate" target="_blank">Use this free tool? Tip me! ($)</a></li>',f='<h2 class="warning"><strong>Warning:</strong> This section can make bulk changes to your product metafields. There is no undo should something go wrong so be very sure you want to attempt this.</h2><table><tr><td>Namespace</td><td><input id="bulk_namespace" placeholder="Namespace" type="text" /></td></tr><tr><td>Key</td><td><input id="bulk_key" placeholder="Key" type="text" /></td></tr><tr><td>Value</td><td><input id="bulk_value" type="text" placeholder="value" /></td></tr><tr><td colspan="2"><p><strong>Note:</strong> Any existing metafield with the same namespace and key will be overwritten. Have I given you enough warning?</p></td></tr><tr><td><a class="btn create">Save</a> <a class="btn createint">Save Integer</a></td><td><span style="display:none"><a class="btn delete">Delete</a> <input type="text" style="width:50%" placeholder="Type delete" /></span></td></tr><tr><td colspan="2"><textarea class="debug" placeholder="Data Output (future use only)"></textarea></td></tr></table>',v='<li><a id="autosave" tabindex="-1" class="btn btn-slim tooltip tooltip-bottom" href="#"><span class="tooltip-container"><span class="tooltip-label">Enable Autosave</span></span>Autosave</a></li>',h='<table><tr><td>How many days back do we search?</td><td><input value="30" id="from_recent_order_id" placeholder="days" type="text" /></td></tr><tr><td>Fulfillment Status</td><td><select id="recent_fulfillment_status"><option value="any">Any</option><option value="partial">Partial</option><option value="unshipped">Unshipped</option><option value="shipped">Shipped</option></select></td></tr><tr><td><a class="btn getdata">Get Emails</a></td><small>For now this grabs the email only and adds it to the box below. If you would like to see this work differently - let me know!</small><td></td></tr></table><textarea id="recent_emails_output" class="debug" placeholder="Email addresses will load here..."></textarea>',g="<ul><li>Jump quickly between editor for product and linklists via a dropdown menu</li><li>Autosave added for products RTE</li><li>Added linklist creator for collections, pages and vendors</li><li>Added a copy function to link lists</li><li>Bulk tag editing enabled on collections page.</li><li>Copy and paste for Shipping rates added.</li></ul>",_="ShopifyFD: Recent updates and news",y='<p>ShopifyFD is "honor-ware", which means that we trust each other to be nice. As the developer of it, I\'m committed to keep the tool something that\'s actually useful. By releasing new features and correcting possible bugs on a constant basis I can do just that, but I need your support. If you use it and intend to keep it, please sponsor its development by making a small <a target="_blank" href="http://shopify.freakdesign.com.au/#donate">contribution</a>.</p><p>You can track changes by keeping an eye on the project page or following me on <a target="_blank" href="https://twitter.com/freakdesign">twitter</a>.</p><p><h4 style="margin-top:1em">Resources and links</h4><ul><li><a href="http://shopify.freakdesign.com.au" target="_blank">Project home page</a></li><li><a href="http://goo.gl/OsFK2d" target="_blank">Feature Request</a></li><li><a href="http://bit.ly/shopifyFD_forum" target="_blank">Shopify forum post</a></li></ul></p>',b="<p>Do note that once you run this you are going to have to manually refresh to see the updates. Annoying I know, but I have not found a way around this...</p>",k='<div class="bubble ssb hide" style="bottom: 5px;"><div class="bubble-content p"><h3 class="large">Orders</h3><div class="fl pr"><ul class="unstyled"></ul></div></div><footer class="bubble-footer"><div class="bubble-arrow-wrap"><span class="bubble-arrow-border"></span><span class="bubble-arrow"></span></div></footer></div>',w='<div><div class="clearfix em"><div class="half">Choose a collection</div><div class="half"><select data-action="collection"><option value="">Loading, please wait...</option></select></div></div><div class="clearfix em"><div class="half">Choose an action</div><div class="half"><select data-action="action"><option value="add">Add</option><option value="set">Set</option><option value="remove">Remove</option><option disabled value="toggle">Toggle</option><option value="purge" style="background:red;color:#fff">DELETE ALL</option></select></div></div><div class="clearfix em"><div class="half">Set the tag</div><div class="half"><input /></div></div><div class="half"><a class="btn" data-action="update_tags">Update tags</a></div><div class="half"><small>Add: Adds tags to the existing ones<br>Set: Replaces tags with new ones<br>Remove: Removes matching tags<br>Toggle: Future Use, disabled...</small></div></div>',j=function(){var t={debug:!1,drag_on:!0,author:"freakdesign",version:20131111,alpha:!1,omega:!1,countries:!1,wait:1e3,api_count:0,api_limit:250,metafields:{},autosave:!1,content:$("#content")};return{escape:function(e){return e.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\/]/g,"\\/").replace(/[\b]/g,"\\b").replace(/[\f]/g,"\\f").replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r").replace(/[\t]/g,"\\t")},redirect:function(e){e&&"function"==typeof Batman?Batman.redirect(e):j.notice("Can not redirect",!0)},createCookie:function(e,t,a){if(a){var i=new Date;i.setTime(i.getTime()+1e3*60*60*24*a);var n="; expires="+i.toGMTString()}else var n="";document.cookie=e+"="+t+n+"; path=/"},readCookie:function(e){for(var t=e+"=",a=document.cookie.split(";"),i=0;i<a.length;i++){for(var n=a[i];" "==n.charAt(0);)n=n.substring(1,n.length);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return null},notice:function(e,t){"function"==typeof Shopify.Flash.error&&"function"==typeof Shopify.Flash.notice&&(t?Shopify.Flash.error(e):Shopify.Flash.notice(e))},about_app:function(){return j.fd_modal(!0,y,"About this tool",!0),!1},show_notification:function(){j.fd_modal(!0,g,_),$("#getnotifications").find("i").removeClass("blinker")},flash_notification:function(){$("#getnotifications").find("i").addClass("blinker")},createbackup:function(t){if(t){var a=$("iframe").contents().find("#tinymce"),i=a.html(),n={metafield:{namespace:"backups",key:t,value:i,value_type:"string"}};$.ajax({type:"POST",url:e.URL+"/metafields.json",dataType:"json",data:n,success:function(){j.updatedropdown(),j.notice("Backup saved")},error:function(e){var t=JSON.parse(e.responseText);j.notice(t.errors.value[0],!0)}})}},loadmeta:function(t,a){var i="/admin/"+j.data("alpha")+"/"+j.data("omega")+"/metafields.json";"general"===j.data("omega")&&(i="/admin/metafields.json"),"articles"===j.data("alpha")&&(i="/admin/articles/"+j.data("omega")+"/metafields.json"),$.getJSON(i,function(i){var n="",o=i.metafields;if(o){j.data("m",o),"products"==j.data("alpha")&&j.setup_copypaste();var l=$("#metacount");l.text(o.length).addClass("active"),0===o.length?l.removeClass("active"):l.addClass("active");for(var d=0,c=o.length;c>d;d++)n+='<option data-type="'+o[d].value_type+'" data-id="'+o[d].id+'">'+o[d].namespace+"."+o[d].key+"</option>",a.metafields[o[d].id]={namespace:o[d].namespace,value:o[d].value,key:o[d].key},"backups"==o[d].namespace&&(j.flog("hasbackup!"),$("#restorebackup").show(),j.data("hasbackup",!0));n='<select id="metafieldselect">'+r+n+"</select>"}else n='<select id="metafieldselect">'+r+"</select>";t.html(n).append(s),$("#advanced_meta_features").off("click").on("click",function(){var e=$("#advanced_meta").eq(0);return e.toggleClass("hidden"),!1}),$("#adv_clear_cache").off("click").on("click",function(){return $("#advanced_meta").find("select").remove().end().find("a").show(),j.data("products",!1),j.data("collections",!1),!1}),$("#adv_get_products").off("click").on("click",function(){var e=$(this);if(j.data("products")){for(var t=j.data("products"),a="",i=$("<select />",{}).change(function(){var e=$(this);$("#metafield_value").val(e.val())}).html('<option value="">Add product handle as value</option>'),n=0,s=t.products.length;s>n;n++)a+='<option value="'+t.products[n].handle+'">'+t.products[n].title+"</option>";i.append(a),e.after(i).hide()}else $.ajax({type:"GET",url:"/admin/products.json",dataType:"json",success:function(t){if(t.products.length){j.data("products",t);for(var a="",i=$("<select />",{}).change(function(){var e=$(this);$("#metafield_value").val(e.val())}).html('<option value="">Add product handle as value</option>'),n=0,s=t.products.length;s>n;n++)a+='<option value="'+t.products[n].handle+'">'+t.products[n].title+"</option>";i.append(a),e.after(i).hide()}},fail:function(){j.notice("Failed to load products",!0)}});return!1}),$("#adv_get_collections").off("click").on("click",function(){var e=$(this);if(j.data("collections")){for(var t=j.data("collections"),a="",i=$("<select />",{}).change(function(){var e=$(this);$("#metafield_value").val(e.val())}).html('<option value="">Add collection handle as value</option>'),n=0,s=t.collections.length;s>n;n++)a+='<option value="'+t.collections[n].handle+'">'+t.collections[n].title+"</option>";i.append(a),e.after(i).hide()}else $.ajax({type:"GET",url:"/admin/collections.json",dataType:"json",success:function(t){if(t.collections.length){j.data("collections",t);for(var a="",i=$("<select />",{}).change(function(){var e=$(this);$("#metafield_value").val(e.val())}).html('<option value="">Add collection handle as value</option>'),n=0,s=t.collections.length;s>n;n++)a+='<option value="'+t.collections[n].handle+'">'+t.collections[n].title+"</option>";i.append(a),e.after(i).hide()}},fail:function(){j.notice("Failed to load collections",!0)}});return!1}),$("#metafieldselect").change(function(){var e=$(this).find(":selected");if(e.attr("data-id")){var t=a.metafields[e.attr("data-id")],i="string",n="Convert to integer";"integer"===e.attr("data-type")&&(i="integer",n="Convert to string"),$('a[data-action="convert_mf_type"]').text(n).attr("data-type",i),$("#metafield_namespace").val(t.namespace).prop("disabled",!0),$("#metafield_key").val(t.key).prop("disabled",!0),$("#metafield_value").val(t.value),$("#metafield_id").val(e.attr("data-id")),$("#shopifyjs_deletemetafield").removeClass("hidden"),$('a[data-action="convert_mf_type"]').removeClass("hidden")}else j.clearmetaform()}),$("#shopifyjs_deletemetafield").on("click",function(){var t=$("#metafield_id").val(),a=e.URL+"/metafields/"+t+".json";"general"===j.data("omega")&&(a="/admin/metafields/"+t+".json"),"articles"===j.data("alpha")&&(a="/admin/articles/"+j.data("omega")+"/metafields/"+t+".json"),t&&$.ajax({type:"DELETE",url:a,success:function(e){j.flog(e),j.notice("Metafield deleted"),j.updatedropdown()},error:function(){j.notice("Failed to delete",!0)}})}),$('a[data-action="convert_mf_type"]').off("click").on("click",function(){var t=$(this),a="string";"string"===t.attr("data-type")&&(a="integer");var i=$("#metafield_namespace").val(),n=$("#metafield_key").val(),s=$("#metafield_id").val(),o={metafield:{value_type:a}};if(n&&i){var l=e.URL+"/metafields/"+s+".json";$.ajax({type:"PUT",url:l,dataType:"json",data:o,success:function(e){j.updatedropdown(),j.flog(e),j.notice("Metafield switched to "+a)},error:function(e){var t=JSON.parse(e.responseText);j.notice(t.errors.value[0],!0)}})}else j.notice("No metafield found",!0);return!1}),$("div.sub_section-summary a.savemymeta").off("click").on("click",function(){var t="string";$(this).hasClass("int")&&(t="integer");var a=$("#metafield_namespace").val(),i=$("#metafield_key").val(),n=$("#metafield_value").val(),s=$("#metafield_id").val(),o={metafield:{namespace:a,key:i,value:n,value_type:t}},l={metafield:{id:s,value:n,value_type:t}};if(s.length>5){var r=e.URL+"/metafields/"+s+".json";"general"===j.data("omega")&&(r="/admin/metafields/"+s+".json"),$.ajax({type:"PUT",url:r,dataType:"json",data:l,success:function(e){j.updatedropdown(),j.flog(e),j.notice("Metafield updated")}})}else{var r=e.URL+"/metafields.json";"general"===j.data("omega")&&(r="/admin/metafields.json"),"articles"===j.data("alpha")&&(r="/admin/articles/"+j.data("omega")+"/metafields.json"),$.ajax({type:"POST",url:r,dataType:"json",data:o,success:function(){j.updatedropdown(),j.notice("Metafield saved")},error:function(e){var t=JSON.parse(e.responseText),a="";t.errors.namespace&&(a+="Namespace "+j.escape(t.errors.namespace[0])+". "),t.errors.key&&(a+="Key "+j.escape(t.errors.key[0])+". "),t.errors.value&&(a+="Value "+j.escape(t.errors.value[0])+". "),j.notice("Metafield failed to save: "+a,!0)}})}return!1})})},bulk_save_metafield_queue:function(e,t,a){$.ajax({type:"POST",url:"/admin/products/"+j.data("products")[t].id+"/metafields.json",dataType:"json",data:e,success:function(){if(a){var i=a.val();a.val(i+t+": "+j.data("products")[t].id+": ok\n")}t+1<j.data("products").length?j.bulk_save_metafield_queue(e,t+1,a):("products"==j.data("alpha")&&j.updatedropdown(),j.notice("Bulk changes done!"))}})},bulkmetafields:function(){var e=$(f),t=e.find("a.create"),a=e.find("a.createint"),i=(e.find("a.update"),e.find("a.delete"),e.find("#bulk_namespace")),n=e.find("#bulk_key"),s=e.find("#bulk_value"),o=e.find("textarea.debug"),l=function(){return 1<i.val().length&&1<n.val().length&&1<s.val().length?!0:!1};t.off("click").on("click",function(){if(l){var e={metafield:{namespace:i.val(),key:n.val(),value:s.val(),value_type:"string"}};j.bulk_save_metafield_queue(e,0,o)}else j.notice("No empty fields allowed")}),a.off("click").on("click",function(){if(l)if(isNaN(s.val()))j.notice("Value not an integer",!0);else{o.val(j.data("products"));var e={metafield:{namespace:i.val(),key:n.val(),value:s.val(),value_type:"integer"}};j.bulk_save_metafield_queue(e,0,o)}else j.notice("No empty fields allowed",!0)}),$.ajax({type:"GET",url:"/admin/products.json?fields=id,title",dataType:"json",success:function(t){t.products&&(t.products.length?(j.data("products",t.products),j.fd_modal(!0,e,"Bulk Metafield editing (for "+t.products.length+" products)",!0)):j.notice("No products found",!0))},error:function(){j.notice("Error getting products",!0)}})},clearformatting:function(){var e=$("iframe").contents().find("#tinymce"),t=document.createElement("div");t.innerHTML=e.html();var a=t.textContent||t.innerText||"";e.text(a)},clearmetaform:function(){$("#metafield_namespace").val("").prop("disabled",!1),$("#metafield_key").val("").prop("disabled",!1),$("#metafield_value").val(""),$("#metafield_id").val(""),$("#shopifyjs_deletemetafield").addClass("hidden"),$('a[data-action="convert_mf_type"]').addClass("hidden")},supports_html5_storage:function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}},kill_drag_drop:function(){if(j.data("drag_on")){var e=document.documentElement;e.className="",e.ondragover=function(){return!1},e.ondragleave=function(){return!1},e.ondragend=function(){return!1},e.ondrop=function(){}}},set_drag_drop:function(){if(j.data("drag_on")){var e=function(){var e=document.createElement("div");return"draggable"in e||"ondragstart"in e&&"ondrop"in e};if(e()){j.flog("has dnd");var t=document.documentElement;t.ondragover=function(){return this.className="dragit",!1},t.ondragleave=function(){return this.className="",!1},t.ondragend=function(){return this.className="",!1},t.ondrop=function(e){e.preventDefault&&e.preventDefault();var t=e.dataTransfer.files,a=t.length,i=0,n=new FileReader,s={};return n.onload=function(e){j.flog("load");var o=e.target.result,l=o.split(",")[1];s[i]={name:t[i].name,data:l},i++,a>i?(j.notice("Reading file ["+(i+1)+"] contents..."),n.readAsDataURL(t[i])):j.do_upload(s)},a&&(document.documentElement.className="dragit",j.notice("Reading file ["+(i+1)+"] contents..."),n.readAsDataURL(t[i])),!1}}}},do_upload:function(e){if(j.data("drag_on")){var t=e,a=Object.keys(e).length,i=0,n=j.data("themeID");if("themes"==j.data("alpha")&&(n=j.data("omega")),"settings"!=j.data("omega")||isNaN(j.data("alpha"))||(n=j.data("alpha")),n){var s=function(){var e={asset:{key:"assets/"+t[i].name,attachment:t[i].data}};$.ajax({type:"PUT",url:"/admin/themes/"+n+"/assets.json",data:e,success:function(){j.notice(t[i].name+" uploaded ("+(i+1)+"/"+a+")"),i++,a>i&&s(),i==a&&(document.documentElement.className="")},error:function(){j.notice("File upload failed",!0),document.documentElement.className=""}})};s()}else j.notice("Theme ID not found",!0)}},get_product_count:function(){$.ajax({type:"GET",url:"/admin/products/count.json",success:function(e){e&&j.data("product_count",e.count)}})},get_all_product_metafields:function(){j.data("product_count")<=j.data("api_limit")},save_variant_metafield:function(e,t,a,i,n,s){j.flog(e,t,a,i,n,s);var o="string";if(s&&(o="integer"),n.length){var l={metafield:{id:n,value:i,value_type:o}};$.ajax({type:"PUT",url:"/admin/variants/"+e+"/metafields/"+n+".json",data:l,success:function(t){j.flog(t),j.setup_vrow(e),j.notice("Metafield updated")},error:function(){j.setup_vrow(e),j.notice("Error saving",!0)}})}else{var l={metafield:{namespace:t,key:a,value:i,value_type:o}};$.ajax({type:"POST",url:"/admin/variants/"+e+"/metafields.json",data:l,success:function(t){j.flog(t),j.setup_vrow(e),j.notice("Metafield saved")},error:function(){j.setup_vrow(e),j.notice("Error Saving",!0)}})}},delete_variant_metafield:function(e,t){$.ajax({type:"DELETE",url:"/admin/variants/"+e+"/metafields/"+t+".json",success:function(t){j.flog(t),j.setup_vrow(e),j.notice("Metafield deleted")},error:function(){j.setup_vrow(e),j.notice("Failed to delete",!0)}})},variant_fillfields:function(e){for(var t=!1,a=0,i=j.data("vm").length;i>a;a++)if(o=j.data("vm")[a],parseInt(o.id)==parseInt(e))return o;return t},setup_vrow:function(e){$("#mv_namespace").val("").prop("disabled",!1),$("#mv_key").val("").prop("disabled",!1),$("#mv_value").val(""),j.data("current_vid","");var t=function(e){return'<option class="meta" value="'+e.id+'">'+e.namespace+"."+e.key+"</option>"};e?$.ajax({type:"GET",url:"/admin/variants/"+e+"/metafields.json",success:function(a){$("#vrow option.meta").remove(),m=a.metafields,m&&(j.data("vm",m),m.length?$("#vrow select").addClass("active"):$("#vrow select").removeClass("active"));for(var i=0,n=m.length;n>i;i++)$("#vrow select").append(t(m[i]));$("#vrow .delete").hide(),$("#vrow .save").off("click").on("click",function(){return j.data("current_vid")||j.data("current_vid",""),j.save_variant_metafield(e,$("#mv_namespace").val(),$("#mv_key").val(),$("#mv_value").val(),j.data("current_vid")),!1}),$("#vrow .saveinteger").off("click").on("click",function(){return j.data("current_vid")||j.data("current_vid",""),j.save_variant_metafield(e,$("#mv_namespace").val(),$("#mv_key").val(),$("#mv_value").val(),j.data("current_vid"),!0),!1}),$("#vrow .delete").off("click").on("click",function(){return j.delete_variant_metafield(e,j.data("current_vid")),!1}),$("#vrow select").eq(0).off("change").change(function(){var e=$(this).val();if(j.data("current_vid",e),j.flog(j.data("vm")),e.length){$("#mv_namespace").prop("disabled",!0),$("#mv_key").prop("disabled",!0),$("#vrow .delete").show();var t=j.variant_fillfields(e);t&&($("#mv_namespace").val(t.namespace),$("#mv_key").val(t.key),$("#mv_value").val(t.value))}else $("#mv_namespace").prop("disabled",!1),$("#mv_key").prop("disabled",!1),$("#vrow .delete").hide()}),$("#vrow .mybuttons").fadeIn()},error:function(){j.notice("Error grabbing metafields",!0)}}):j.notice("Could not find ID",!0)},panel_editvariantmeta:function(){$(".row.section.inventory .section-summary p").after('<p class="box notice">To edit metafields for the variant click in the variant ID number field.</p>'),$("td.vid input").on("change",function(){var e=$(this);e.val(e.attr("data-val"))}),$("td.vid input").on("click",function(){$("#vrow").remove();var e=$(this),t=e.attr("data-val");e.select(),j.flog(t),j.data("currentvrow",t),$("tr.variant.active").removeClass("active");var a=e.parent().parent();tp_td=a.find("td").length+1,a.addClass("active").after('<tr id="vrow"><td colspan="'+tp_td+'">'+p+"</td></tr>"),j.setup_vrow(t)})},btn_removealltags:function(){$("div.row.section.tags div.section-summary").eq(0).append('<a id="addalltags" href="#" class="btn">Add all tags</a> <a id="removealltags" href="#" class="btn">Remove all tags</a>'),$("#removealltags").on("click",function(){return $("ul.tokenized-list").eq(0).find("a").click(),!1}),$("#addalltags").on("click",function(){return $("ul.addtags").eq(0).find("span:not(.inactive)").click(),!1})},flog:function(e){j.data("debug")&&console.log(e)},fd_modal_update:function(){var e=$("#fdmodal");e.length&&e.remove()},fd_modal:function(e,t,a,i){j.flog("fdmodal");var n=$("#fdmodal");if(e){n.length&&n.remove();var s=$('<div id="fdmodal" class="modalWindow"><div class="main content"><header></header></div></div>');if(a&&s.find("header").html("<h2>"+a+"</h2>"),t){var o=$("<div/>",{}).append(t);s.find("div.main.content").append(o)}if(i){var l=$('<a href="#" class="close-modal">X</a>');l.on("click",function(){return j.fd_modal(!1),!1}),s.find("header").prepend(l).end().fadeIn()}else s.fadeIn().on("click",function(){j.fd_modal(!1)});$("body").append(s)}else n.off("click").remove()},restorebackup:function(){var e=$("iframe").contents().find("#tinymce"),t=j.data("m");if(t)for(var a=0,i=t.length;i>a;a++)"backups"==t[a].namespace&&(e.html(t[a].value),j.notice("Backup restored"));else j.notice("Error, nothing to restore")},setup_discounts:function(){var e=$("<ul/>",{"class":"segmented",id:"discount_buttons"}),t=$("<li/>"),a=$("<a/>",{"class":"btn btn-separate",href:"#",title:"Disable all codes below"}).html("Disable codes").on("click",function(){return $('#discount-table a[data-event-click="discount.disable"]').click(),!1}),i=$("<a/>",{"class":"btn btn-separate",href:"#",title:"Enable all codes below"}).html("Enable codes").on("click",function(){return $('#discount-table a[data-event-click="discount.enable"]').click(),!1}),n=$("<a/>",{"class":"btn btn-separate disabled",href:"#"}).html("Bulk create").on("click",function(){return j.data("debug")||j.fd_modal(!0,"<p>This is on the todo list. Will get to it soon(ish)</p></div>","Bulk create discount codes",!0),!1});t.append(a,i,n),e.append(t),$(".header-right .segmented").eq(0).after(e)},setup_articles:function(){j.flog("setup_articles"),$("div.span6.section-summary a.view-in-store").remove(),$("div.span6.section-summary").eq(0).find("p, h1").remove().end().append(l);var e=$("div.sub_section-summary .content");j.loadmeta(e,t)},setup_blogs:function(){var e=$("div.span6.section-summary a.view-in-store"),a=$('h1.header-main span[data-bind="blog.title"]');a.addClass("view-in-store").html('<a target="shopify_storeview" href="'+e.prop("href")+'">'+a.text()+"</a>").prop("title","View in store"),e.remove(),$("div.span6.section-summary").eq(0).find("p, h1").remove().end().append(l);var i=$("div.sub_section-summary .content");window.setTimeout(function(){j.loadmeta(i,t)},250)},setup_rte:function(){j.data("hasbackup")&&$("#restorebackup").show(),$("#clearformatting").on("click",function(){return j.clearformatting(),!1}),$("#createbackup").on("click",function(){return j.createbackup(j.data("omega")),!1}),$("#restorebackup").on("click",function(){return j.restorebackup(j.data("omega")),!1}),$("#save_images_to_meta").on("click",function(){return j.save_images_to_meta(),!1})},save_images_to_meta:function(){var t=$("iframe").contents().find("#tinymce").find("img");if(t&&t.length){var a="";t.each(function(e){var i=$(this).prop("src").replace(/https:/i,"");a+=i,e<t.length-1&&(a+=",")});var i={metafield:{namespace:"helpers",key:"images",value:a,value_type:"string"}};$.ajax({type:"POST",url:e.URL+"/metafields.json",dataType:"json",data:i,success:function(){j.updatedropdown(),j.notice("Images saved to metafield")},error:function(){j.notice("Error saving",!0)}})}else j.notice("No images found",!0)},array_unique:function(e){for(var t=e.concat(),a=0;a<t.length;++a)for(var i=a+1;i<t.length;++i)t[a]===t[i]&&t.splice(i--,1);return t},setup_products_list:function(){if(!$("#showsku").length){var e=$("<ul/>",{"class":"segmented",id:"showsku"}),t=$("<li/>"),a=$("<a/>",{"class":"btn",href:"#",title:"Show SKU and Variant IDs"}).html("Show SKUs & ID").on("click",function(){var e=[],t=$("#all-products td.name a");if(t.each(function(){e.push($(this).attr("href").split(/[/]+/).pop())}),e.length){var a=0,i=function(e,a){$.ajax({type:"GET",url:"/admin/products/"+e[a]+".json?fields=variants",dataType:"json",success:function(n){var s=n.product.variants[0].sku,o=n.product.variants[0].id,l="";(s||o)&&(s&&(l='<span title="SKU" class="sku label">'+s+"</span>"),t.eq(a).before(l+'<span title="VariantID" class="variant label">'+o+"</span>")),a+1<e.length?i(e,a+1):j.fd_modal(!1)}})};j.fd_modal(!0,"Loading SKUs and Variant IDs, please wait...","Loading",!0),i(e,a)}return!1});t.append(a),e.append(t),$(".header-right .segmented").eq(1).after(e)}},setup_link_lists_edit:function(){$.ajax({type:"GET",url:"/admin/link_lists.json",dataType:"json",success:function(e){if(e){link_lists=e.link_lists;for(var t="",a=0,i=link_lists.length;i>a;a++)j.data("omega")!==link_lists[a].id.toString()&&(t+='<option value="'+link_lists[a].id+'">'+link_lists[a].title+"</option>");var n=$("<select />",{id:"shopifyjs_llselect","class":"header-select"}).append("<option>Choose another linklist to edit</option>",t).change(function(){var e=$(this).val();e&&j.redirect("/link_lists/"+e)});$(".header-row .header-right").prepend(n)}},error:function(){j.notice("Error loading linklist data",!0)}})},setup_link_lists:function(){var e=$("div.linklist-container .box-footer"),t=function(){return $.ajax({type:"GET",url:"/admin/collections.json?limit=250",dataType:"json",success:function(e){for(var t={link_list:{handle:"all-collections",title:"All Collections",links:[]}},a=0,i=e.collections.length;i>a;++a)t.link_list.links.push({position:a+1,title:e.collections[a].title,link_type:"collection",subject_id:e.collections[a].id});n(t)},error:function(){j.notice("Error! Are you sure you have access to collections?",!0)}}),!1},a=function(){return $.ajax({type:"GET",url:"/admin/pages.json?limit=250",dataType:"json",success:function(e){for(var t={link_list:{handle:"all-pages",title:"All Pages",links:[]}},a=0,i=e.pages.length;i>a;++a)t.link_list.links.push({position:a+1,title:e.pages[a].title,link_type:"page",subject_id:e.pages[a].id});n(t)},error:function(){j.notice("Error! Are you sure you have access to pages?",!0)}}),!1},i=function(){$.ajax({type:"GET",url:"/admin/products/vendors.json",dataType:"json",success:function(e){for(var t={link_list:{handle:"all-vendors",title:"All Vendors",links:[]}},a=0,i=e.vendors.length;i>a;++a)t.link_list.links.push({position:a+1,title:e.vendors[a],link_type:"http",subject:"/collections/vendors?q="+encodeURIComponent(e.vendors[a].toLowerCase()).replace(/%20/g,"+")});n(t)}})},n=function(e){$.ajax({type:"POST",url:"/admin/link_lists.json",data:JSON.stringify(e),contentType:"application/json;charset=utf-8",dataType:"json",success:function(e){j.notice("Link list added"),e.link_list.id&&j.redirect("/link_lists/"+e.link_list.id)}})},s=$("<a/>",{href:"#","class":"btn btn-slim fr",style:"margin-right:.5em"}).text("Copy").on("click",function(){var e=$(this),t=e.parent().find('a[data-route="link_list"]').eq(0);return t.length&&(href=t.attr("href").split("/").pop(),isNaN(href)||$.ajax({type:"GET",url:"/admin/link_lists/"+href+".json",dataType:"json",success:function(e){delete e.link_list.id,delete e.link_list["default"],e.link_list.title+=" COPY",e.link_list.handle+="-copy",n(e)}})),!1});e.append(s);var o=$(".span6.section-summary").eq(0),l=$("<a/>",{"class":"btn",href:"#",title:"Create a linklist with every collection"}).text("Create Collections linklist").on("click",function(){return t(),!1}),r=$("<a/>",{"class":"btn",href:"#",title:"Create a linklist with every page"}).text("Create Pages linklist").on("click",function(){return a(),!1}),d=$("<a/>",{"class":"btn",href:"#",title:"Create a linklist with all vendors"}).text("Create Vendor linklist").on("click",function(){return i(),!1}),c=$("<p/>",{"class":"box warning",style:"margin-top:1em"}).text("If you use the trash can button to remove a linklist some ShopifyFD features will not reload. Navigate away from the page, and back again.");o&&o.append("<br><br>",l,"<br><br>",r,"<br><br>",d).find("p:eq(0)").append(c)},setup_collections:function(){j.data("collections",!1);var e=$("<ul/>",{"class":"segmented"}),t=$("<li/>"),a=$("<a/>",{"class":"btn",href:"#",title:"Add tags to entire collection"}).html("Bulk edit tags").on("click",function(){j.fd_modal(!0,w,"Edit tags for all products in a collection",!0);
var e=$("#fdmodal"),t=e.find('select[data-action="action"]'),a=e.find("a").eq(1),i=e.find('select[data-action="collection"]'),n=e.find("input").eq(0);t.change(function(){"purge"==t.val()||"set"==t.val()?("purge"==t.val()&&n.val("").attr("disabled","disabled"),a.addClass("delete")):(n.removeAttr("disabled"),a.removeClass("delete"))});var s=function(e,t,i,n){var o=e.products[t].id,l={product:{id:o,tags:i}};a.text(t+1+"/"+e.products.length),$.ajax({type:"PUT",url:"/admin/products/"+o+".json",data:l,dataType:"json",success:function(){++t,t<e.products.length?s(e,t,i,n):n()}})},o=function(e,t,i,n){if(e.products[t].tags){var s=i.replace(/, /g,",").split(","),l=e.products[t].tags.replace(/, /g,",").split(","),r=$(l).not(s).get()+"",d=e.products[t].id,c={product:{id:d,tags:r}};a.text(t+1+"/"+e.products.length),$.ajax({type:"PUT",url:"/admin/products/"+d+".json",data:c,dataType:"json",success:function(){++t,t<e.products.length?o(e,t,i,n):n()}})}else++t,t<e.products.length?o(e,t,i,n):n()},l=function(e,t,i,n){var s=i.replace(/, /g,",").split(","),o=e.products[t].tags.split(","),r=j.array_unique(s.concat(o))+"",d=e.products[t].id,c={product:{id:d,tags:r}};a.text(t+1+"/"+e.products.length),$.ajax({type:"PUT",url:"/admin/products/"+d+".json",data:c,dataType:"json",success:function(){++t,t<e.products.length?l(e,t,i,n):n()}})};return a.on("click",function(){return i.val().length?("add"==t.val()&&n.val().length&&$.ajax({type:"GET",url:"/admin/products.json?collection_id="+i.val()+"&fields=id,tags",dataType:"json",success:function(e){a.addClass("disabled"),l(e,0,n.val(),function(){j.notice("Done. Tags have been added"),a.text("Update tags").removeClass("disabled")})}}),("purge"==t.val()||"set"==t.val())&&$.ajax({type:"GET",url:"/admin/products.json?collection_id="+i.val()+"&fields=id",dataType:"json",success:function(e){a.addClass("disabled"),s(e,0,n.val(),function(){j.notice("Done."),a.text("Update tags").removeClass("disabled")})}}),"remove"==t.val()&&$.ajax({type:"GET",url:"/admin/products.json?collection_id="+i.val()+"&fields=id,tags",dataType:"json",success:function(e){a.addClass("disabled"),o(e,0,n.val(),function(){j.notice("Matched tags have been removed."),a.text("Update tags").removeClass("disabled")})}})):j.notice("Choose a collection",!0),!1}),t.hide(),$.ajax({type:"GET",url:"/admin/collections.json",dataType:"json",success:function(e){if(e.collections.length){j.data("collections",e);for(var a="",n=0,s=e.collections.length;s>n;n++)a+='<option value="'+e.collections[n].id+'">'+e.collections[n].title+"</option>";i.append(a).find("option:eq(0)").text("Select a collection"),t.show()}}}),!1});t.append(a),e.append(t),$(".header-right .segmented").eq(1).after(e)},seo_description:function(){var e=$("#seo-description-tag"),t=$("<textarea/>");t.val(e.val()).keyup(function(){e.val($(this).val())}),e.after(t).hide()},setup_copypaste:function(){var e=$(d),t=e.find("#fd_pastemetafields"),a=e.find("#fd_whatmetafields");e.find("#fd_copymetafields").on("click",function(){return j.data("m")?(j.data("m-copy",j.data("m")),j.notice(j.data("m-copy").length+" Metafields copied"),t.show(),a.show()):(t.hide(),a.hide()),!1}),a.on("click",function(){if(j.data("m-copy")){for(var e="",t=j.data("m-copy"),a=0,i=t.length;i>a;a++)e+="<p><strong>"+t[a].namespace+"."+t[a].key+" ("+t[a].value_type+")</strong><br>"+t[a].value+"</p><hr>";j.fd_modal(!0,e,"In the virtual clipboard...")}return!1}),t.on("click",function(){return j.data("m-copy")&&j.save_metafield_queue(j.data("m-copy"),0),!1}),j.data("m-copy")||(t.hide(),a.hide()),$("div.sub_section-summary").after(e)},save_metafield_queue:function(t,a){j.fd_modal(!0,"","Please wait whilst we past the metafields",!0);var i={metafield:{namespace:t[a].namespace,key:t[a].key,value:t[a].value,value_type:t[a].value_type}};$.ajax({type:"POST",url:e.URL+"/metafields.json",dataType:"json",data:i,success:function(){a+1<t.length?j.save_metafield_queue(t,a+1):(j.updatedropdown(),j.fd_modal(!1),j.notice("Pasted!"))}})},setup_products:function(){clearInterval(j.data("autosave")),$.ajax({type:"GET",url:"/admin/products.json?limit=25",dataType:"json",success:function(e){if(e){products=e.products;var t="",a=products.length;if(25>=a){for(var i=0;a>i;i++)j.data("omega")!==products[i].id.toString()&&(t+='<option value="'+products[i].id+'">'+products[i].title+"</option>");var n=$("<select />",{id:"shopifyjs_pselect","class":"header-select"}).append("<option>Choose another product to edit</option>",t).change(function(){var e=$(this).val();e&&j.redirect("/products/"+e)});$(".header-row .header-right").prepend(n)}}},error:function(){j.notice("Error loading linklist data",!0)}}),$("div.span6.section-summary").eq(0).append(l).find("div:first-child").remove(),0==$("#rte_extra").length?($("#product-body-html_ifr").eq(0).after(c),j.setup_rte(),$(".rtetools-buttons ul.fr").eq(1).append(v),$("#autosave").on("click",function(){var e=$(this),t=!1;return e.hasClass("rte-command-active")?(j.notice("Autosave disabled"),clearInterval(j.data("autosave"))):(t=$('#products-show header input[type="submit"]'),j.notice("Autosave enabled"),j.data("autosave",setInterval(function(){t.length?t.click():(clearInterval(j.data("autosave")),t=null,j.notice("Autosave disabled"))},3e4))),$(this).toggleClass("rte-command-active"),!1})):j.notice("Bug! I tried to load the content editor twice.",!0),j.btn_removealltags(),j.seo_description();var e=$("div.span6.section-summary a.view-in-store"),a=$('h1.header-main span[data-bind="product.title"]'),i=$("div.sub_section-summary .content"),n={};a.addClass("view-in-store").html('<a target="shopify_storeview" href="'+e.prop("href")+'">'+a.text()+"</a>").prop("title","View in store"),e.remove(),j.loadmeta(i,t),$("#product-inner-variants th:last-child").before("<th>Variant ID</th>"),$("th.inventory.tc").text("#").prop("title","Quantity"),$("tr.variant").each(function(e){var t=$("td.sku input.mock-edit-on-hover").eq(e).prop("id").split(/[- ]+/).pop();n["variant_"+e]={id:t},$(this).find("td:last-child").before('<td class="vid tooltip tooltip-bottom"><input class="mock-edit-on-hover" data-action="selectall" data-val="'+t+'" type="text" value="'+t+'" /><span class="tooltip-container"><span class="tooltip-label">Click to edit Metafields</span></span></td>')}).promise().done(function(){j.panel_editvariantmeta()});var s=$("table.product-collections").eq(0);s.find("tr").each(function(){var e=$("<a/>",{"class":"btn",href:"#",title:"Set a metafield with this collection handle"}).text("Set as preferred").on("click",function(){return j.fd_modal(!0,"soon...","Future function"),!1});$(this).find("td.col-remove").prepend(e)});var o=$("table.variants .bulk-actions").eq(0);if(o.length){var r=$("<a/>",{href:"#","class":"btn btn-slim hidden",style:"padding-left:.5em"}).text("Edit weight").on("click",function(){j.fd_modal(!0,'<label>New weight (grams)</label><input class="half" min="0" type="number" data-action="update-variant-weight" /><a data-action="update-variant-weight" href="#" class="btn btn-slim">Save</a><br><br><small>Note: You will need to reload this page before Shopify will show the new weight in the dashboard.</small>',"Edit weight",!0);var e=$('a[data-action="update-variant-weight"]'),t=$('input[data-action="update-variant-weight"]');return e.length&&t.length&&e.on("click",function(){var a=$('tr.variant input[type="checkbox"]:checked');if(a.length&&!isNaN(t.val())){var i=[];a.each(function(){var e=$(this).parent().parent().find("td.vid").text();isNaN(e)||i.push(parseInt(e))});var n=function(a,i){$.ajax({type:"PUT",url:"/admin/variants/"+i[a],dataType:"json",data:{variant:{id:i[0],grams:t.val()}},success:function(){++a,a<i.length?n(a,i):(j.notice("Weight updated"),e.removeClass("is-loading").text("Save"))}})};e.addClass("is-loading").text(""),n(0,i)}else j.notice("Did you set a weight?",!0);return!1}),!1}),d=($("<span/>",{"class":"hidden"}),$("<a/>",{href:"#","class":"btn btn-slim hidden",style:"padding-left:.5em"}).text("Edit metafields").on("click",function(){var e=$('tr.variant input[type="checkbox"]:checked').eq(0);return e.parent().parent().find("td.vid").click(),!1}));o.append(r,d),$('tr.variant input[type="checkbox"]').on("change",function(){var e=$('tr.variant input[type="checkbox"]:checked').length;e>1?(r.removeClass("hidden"),d.addClass("hidden")):(r.addClass("hidden"),1===e?d.removeClass("hidden"):d.addClass("hidden"))})}},setup_pages:function(){var e=$("div.span6.section-summary a.view-in-store"),a=$('h1.header-main span[data-bind="page.title"]');$("#page-content_ifr").eq(0).after(c),j.setup_rte(),a.addClass("view-in-store").html('<a target="shopify_storeview" href="'+e.prop("href")+'">'+a.text()+"</a>").prop("title","View in store"),j.seo_description(),e.remove(),$("div.span6.section-summary").eq(0).find("p, h1").remove().end().append(l);var i=$("div.sub_section-summary .content");j.loadmeta(i,t),$.ajax({type:"GET",url:"/admin/pages.json",dataType:"json",success:function(e){if(e){pages=e.pages;for(var t="",a=0,i=pages.length;i>a;a++)j.data("omega")!==pages[a].id.toString()&&(t+='<option value="'+pages[a].id+'">'+pages[a].title+"</option>");$(".header-row .header-right").prepend('<select id="shopifyjs_pageselect" class="header-select"><option>Choose another page to edit</option>'+t+"</select>"),$("#shopifyjs_pageselect").change(function(){var e=$(this).val();e&&j.redirect("/pages/"+e)})}},error:function(){j.notice("Error loading page data",!0)}})},shipping_remove_all:function(e,t){if(e>=0)$.ajax({type:"DELETE",url:"/admin/countries/"+t[e].id+".json",dataType:"json",success:function(){j.notice("removed "+t[e].name),e-=1,j.shipping_remove_all(e,t)}});else{var a="/admin/settings/shipping";$.ajax({url:a,success:function(){$("div.shipping-rate-table").remove(),j.redirect("/settings"),setTimeout(function(){j.redirect("/settings/shipping")},2e3)}})}},save_new_rates:function(e,t,a){if(e[t]){var i=e[t],n={},s=i.type,o="";delete i.type,s?("weight"===s?(n={weight_based_shipping_rate:{}},n.weight_based_shipping_rate=i,o="/admin/weight_based_shipping_rates.json"):"price"===s?(n={price_based_shipping_rate:{}},n.price_based_shipping_rate=i,o="/admin/price_based_shipping_rates.json"):"carrier"===s&&(n={carrier_shipping_rate_provider:{}},n.carrier_shipping_rate_provider=i,o="/admin/carrier_shipping_rate_providers.json"),$.ajax({type:"POST",url:o,dataType:"json",data:n,success:function(){a.parent().parent().find("table").append('<tbody><tr style="background:#efefef"><td>'+e[t].name+'</td><td>Pasted a custom shipping rate. <a href=".">Refresh page</a> to view</td><td>'+e[t].price+"</td></tr></tbody>"),t===e.length-1?j.notice("Paste complete"):(t++,j.save_new_rates(e,t,a))}})):j.notice("missing type: "+s,!0)}else j.notice("save_new_rates error - length",!0)},setup_shipping:function(e){if(e){j.fd_modal(!1),$("div.span6.section-summary").eq(0).append('<p style="margin-top:1em" class="box warning">Warning: When you copy and paste over existing rates the old ones still show until the page is refreshed, even though they have been removed. <br><br>Be sure to do a test first. <strong>Use at own risk.</strong></p>');var a=$("#settings-shipping"),i=$('<div class="header-right"><div class="header-action"><ul class="segmented"><li><a class="btn" href="#">Bulk Updates</a></li><li><a class="btn delete btn-separate" href="#">Delete all countries</a></li></ul></div></div>');if(i.find("a").eq(0).on("click",function(){var e=$('<h2 class="warning"><strong>Warning:</strong> This section can make bulk changes to your Shipping rates. There is no undo.</h2><div><div class="span1"><p>Soon...</p></div><div class="span2">'+b+"</div></div>");return j.fd_modal(!0,e,"Bulk Updates",!0),!1}).hide(),i.find("a").eq(1).on("click",function(){var e=$('<h2 class="warning"><strong>Warning:</strong> This is a bad idea. It will delete ALL of your countries. There is no undo. Proceed at own risk!</h2><div><div class="span1"><a href="#" class="btn delete_all delete">Delete</a></div><div class="span2">'+b+"</div></div>");return e.find("a.delete_all").on("click",function(){return $.ajax({type:"GET",url:"/admin/countries.json",dataType:"json",success:function(e){e.countries.length&&(t.countries=e.countries,j.notice(e.countries.length+" countries returned"),j.shipping_remove_all(e.countries.length-1,e.countries))}}),!1}),j.fd_modal(!0,e,"Delete all countries",!0),!1}),a.find("header").eq(0).append(i),$("div.shipping-rate-table").length===j.data("countries").countries.length){var n={weight_based_shipping_rates:[],price_based_shipping_rates:[],carrier_shipping_rate_providers:[]},s=function(e,t,a){if(t.length){var i=[];$.ajax({type:"GET",url:"/admin/countries/"+e+".json",dataType:"json",success:function(e){for(var n=e.country.weight_based_shipping_rates,s=e.country.price_based_shipping_rates,o=e.country.carrier_shipping_rate_providers,l=0,r=n.length;r>l;l++)i.push([n[l].id,"weight"]);for(var l=0,r=s.length;r>l;l++)i.push([s[l].id,"price"]);for(var l=0,r=o.length;r>l;l++)i.push([o[l].id,"carrier"]);for(var l=0,r=i.length;r>l;l++){var d="";"weight"==i[l][1]&&(d="/admin/weight_based_shipping_rates/"),"price"==i[l][1]&&(d="/admin/price_based_shipping_rates/"),"carrier"==i[l][1]&&(d="/admin/carrier_shipping_rate_providers/"),$.ajax({type:"DELETE",url:d+i[l][0]+".json",dataType:"json",success:function(){}})}j.save_new_rates(t,0,a)},fail:function(){j.notice("I failed to get the country.json",!0)}})}else j.notice("Missing items to add",!0)};$("div.shipping-rate-table").each(function(e){var t=$(this),a=$("<a/>",{href:"#","data-country":j.data("countries").countries[e].name,"data-cid":j.data("countries").countries[e].id,"data-index":e,"class":"btn btn-slim copyrates",style:"float:right;margin-right:.5em"}).text("Copy rates").on("click",function(){var e=$(this),t=(e.attr("data-index"),e.attr("data-country")),a=e.attr("data-cid");return $("a.bulkpaste").hide(),$.ajax({type:"GET",url:"/admin/countries/"+a+".json",dataType:"json",success:function(e){n.weight_based_shipping_rates=e.country.weight_based_shipping_rates,n.price_based_shipping_rates=e.country.price_based_shipping_rates,n.carrier_shipping_rate_providers=e.country.carrier_shipping_rate_providers,j.notice("Copy of "+t+" ready"),$("a.bulkpaste").show()}}),!1}),i=$("<a/>",{href:"#","data-country":j.data("countries").countries[e].name,"data-cid":j.data("countries").countries[e].id,"data-index":e,"class":"bulkpaste btn btn-slim",style:"float:right;margin-right:.5em"}).text("Paste rates").on("click",function(){var e=$(this),t=e.attr("data-cid"),a=n,i=a.weight_based_shipping_rates,o=a.price_based_shipping_rates,l=a.carrier_shipping_rate_providers,r=[],d=0;e.parent().parent().find("tbody").remove(),e.parent().find("a.copyrates").remove();for(var c=0,p=i.length;p>c;c++)i[c].country_id=t,delete i[c].id,i[c].type="weight",r[d]=i[c],d++;for(var c=0,p=o.length;p>c;c++)o[c].country_id=t,delete o[c].id,o[c].type="price",r[d]=o[c],d++;for(var c=0,p=l.length;p>c;c++)l[c].country_id=t,delete l[c].id,l[c].type="carrier",r[d]=l[c],d++;return s(t,r,e),!1}).hide();t.find('a[data-event-click="setupNewShippingRateForm"]').after(i,a)})}else j.notice("Mismatch in country count. Reload this page.",!0)}else $.ajax({type:"GET",url:"/admin/countries.json",dataType:"json",success:function(e){e.countries.length&&(j.data("countries",e),j.notice(e.countries.length+" countries loaded"),j.setup_shipping(!0))}})},setup_custom_collections:function(){$("div.row.section.visibility").eq(0).after('<div class="row section" id="customer_meta_box"><div class="span12 section-summary">'+l+"</div></div>");var e=$("div.sub_section-summary .content");j.loadmeta(e,t),0==$("#rte_extra").length&&($("#collection-body-html_ifr").eq(0).after(c),j.setup_rte())},get_files:function(e,t){var a=$("#settings-general table");j.notice("Loading files..."),$.ajax({type:"GET",url:"/admin/files.json?limit=50&direction=next&page="+e,success:function(e){if(e){$("");for(var i=0,n=e.files.length;n>i;i++){var s=$("<tr />",{"class":"file_row"}),o=$("<td />"),l=$("<td />"),r=$("<td />"),d=$("<td />",{"class":"tr"}),c=$("<td />"),p=$("<a />",{href:"#","data-src":e.files[i].public_url.replace("http:","")});if(e.files[i].content_type.indexOf("image")>-1){p.on("click",function(){var e=$(this);return j.fd_modal(!0,'<img src="'+e.attr("data-src")+'" />',"Image Preview",!0),!1}).text(e.files[i].key.replace("files/",""));var u=e.files[i].public_url.replace(/(\.[^\.]+)$/,"_thumb$1").replace("http:","");o.html('<img src="'+u+'" />'),l.append(p),r.html('<input class="select-all-on-focus" value="'+e.files[i].public_url+'">')}else p.attr("href",e.files[i].public_url).attr("target","_blank").text(e.files[i].key.replace("files/",""));d.html(Math.floor(e.files[i].size/1024)+" kB"),s.append(o,l,r,d,c),a.append(s)}i>=t?(j.notice("All loaded"),$(".header-right .segmented").hide()):(++i,j.get_files(i,t))}}})},setup_files:function(){var e=$("<ul/>",{"class":"segmented",id:"get_all_images"}),t=$("<li/>"),a=$("<a/>",{"class":"btn",href:"#",style:"margin-left:1em"}).html("Show all files").on("click",function(){var e=$(this);return e.addClass("is-loading").attr("style","margin-left:1em;text-indent: -9999px;"),$.ajax({type:"GET",url:"/admin/files.json?limit=2&fields=id",success:function(e,t,a){if(e){var i=50,n=a.getResponseHeader("X-Total-Results");if(n>i){var s=Math.ceil(n/i);j.get_files(2,s)}else j.notice("There are no more to load",!0)}},error:function(){e.removeClass("is-loading").attr("style","margin-left:1em"),j.notice("Error loading files",!0)}}),!1});t.append(a),e.append(t),$(".header-right .segmented").eq(0).after(e),$("#settings-general .info-message").prepend('<p class="box notice"><b>Bulk file deletion is coming soon to ShopifyFD...</b></p>')},setup_settings_general:function(){var e=$("<div>",{id:"general_metafields","class":"row section description"}),a=$("<div>",{"class":"span6 section-summary"}),i=$("<div>",{"class":"span18 section-content"});a.html("<h1>Store Metafields</h1><p>Edit your most awesome shop level metafields here...</p>"),i.html(l),e.append(a).append(i),$("div.row.section.description.first-section").eq(0).after(e);var n=$("div.sub_section-summary .content");j.loadmeta(n,t)},setup_customers:function(){$("section.customer-details.ssb .box-details").eq(0).after('<div id="customer_meta_box" class="box box-details"><div class="box-header p"><h3>Metafields</h3></div><div class="box-content p">'+l+"</div>");var e=$("div.sub_section-summary .content");j.loadmeta(e,t)},setup_single_order:function(){$("div.order-sidebar .box-details").eq(0).after('<div id="customer_meta_box" class="box box-details"><div class="box-header p"><h3>Metafields</h3></div><div class="box-content p">'+l+"</div>");var e=$("div.sub_section-summary .content");j.loadmeta(e,t);var a=$('div.address[data-showif="order.billing_address"]').eq(0),i=a.find('a[data-modal-view="ContactCustomerModalView"]'),n=$("<input />",{value:i.text(),"class":"noprint",style:"margin-top:1em"}).on("click",function(){$(this).select()});a.append(n)},setup_orders:function(){var e=$("<ul/>",{"class":"segmented",id:"get_email_list"}),t=$("<li/>"),a=$("<a/>",{"class":"btn",href:"#"}).html("Get emails").on("click",function(){var e=$(h);return e.find("a.getdata").on("click",function(){var e=$("#recent_emails_output"),t=new Date,a=30,i=$("#from_recent_order_id").val(),n=$("#recent_fulfillment_status").val();e.val(""),i.length>0&&(a=parseInt(i)),t.setDate(t.getDate()-a);var s=t.getDate(),o=t.getMonth()+1,l=t.getFullYear(),r=l+"-"+(9>=o?"0"+o:o)+"-"+(9>=s?"0"+s:s)+" 00:00";j.flog(t),j.flog(r),$.ajax({type:"GET",url:"/admin/orders.json?fields=email&fulfillment_status="+n+"&created_at_min="+r,success:function(t){if(t.orders.length){for(var a=t.orders,i="",n=0,s=a.length;s>n;n++)j.flog(a[n].email),i+=a[n].email+",\n";e.val(i)}else j.notice("Error. No results returned",!0)}})}),j.fd_modal(!0,e,"Get recent order emails",!0),!1});t.append(a),e.append(t),$(".header-right .segmented").eq(1).after(e);var i=$('#all-orders a[data-bind="order.name"]'),n=!1;i.append(k).css({position:"relative"}).hover(function(){var e=$(this);n=setTimeout(function(){var t=e.find("ul").eq(0),a=e.attr("href");$("div.bubble").addClass("hide"),e.data("order")?e.find("div.bubble").removeClass("hide"):$.ajax({type:"GET",url:a+".json",success:function(a){if(a){for(var i=a.order.line_items,n=a.order.fulfillments,s="",o=0,l=i.length;l>o;o++)s+='<li style="white-space:normal">'+i[o].quantity+" x "+i[o].name+"</li>";a.order.fulfillment_status&&n.length&&(s+='<li style="white-space:normal;border-top: 1px solid #ccc;margin-top: .5em;padding-top: .5em;">Tracking#: <b>'+n[0].tracking_number+"</b></li>"),e.data("order",s),t.html(s),e.find("div.bubble").removeClass("hide")}}})},200)},function(){clearTimeout(n);var e=$(this);e.find("div.bubble").addClass("hide")})},get_recent_emails:function(){},shortcut_to_open_orders:function(){$('#sidebar span[data-bind="Order.openCount"]').on("click",function(){j.redirect("/orders?query=+financial_status%3Aany+status%3Aopen")}).prop("title","Jump to open orders")},updatedropdown:function(){var a=e.URL+"/metafields.json";"general"===j.data("omega")&&(a="/admin/metafields.json"),"articles"===j.data("alpha")&&(a="/admin/articles/"+j.data("omega")+"/metafields.json"),$.getJSON(a,function(e){var a="",i=e.metafields;if(i.length){j.data("m",i),$("#metacount").text(i.length).addClass("active");for(var n=0,s=i.length;s>n;n++)a+='<option data-type="'+i[n].value_type+'" data-id="'+i[n].id+'">'+i[n].namespace+"."+i[n].key+"</option>",t.metafields[i[n].id]={namespace:i[n].namespace,value:i[n].value,key:i[n].key},"backups"==i[n].namespace&&$("#restorebackup").show();a=r+a}else $("#metacount").text("0").removeClass("active"),j.data("m",!1),$("#restorebackup").hide(),a=r;$("#metafieldselect").html(a),j.clearmetaform()})},load_css:function(){var e=document.createElement("link");e.type="text/css",e.rel="stylesheet",e.id="shopifyjs",e.href="//rawgithub.com/freakdesign/shopifyFD/master/shopifyFD.css",document.body.appendChild(e)},get_theme_data:function(){j.data("themeID")||$.ajax({type:"GET",url:"/admin/themes.json",success:function(e){if(e)for(var t=0,a=e.themes.length;a>t;t++)"main"===e.themes[t].role&&(j.flog(e.themes[t].id),j.data("themeID",e.themes[t].id),j.data("themeName",e.themes[t].name))}})},init:function(){j.shortcut_to_open_orders(),j.set_drag_drop(),j.get_theme_data(),j.data("debug")||j.readCookie("shopifyfd")||(j.flash_notification(),j.createCookie("shopifyfd","loaded",3)),$("#togglestyle").click(),setInterval(function(){if(!j.data("content").hasClass("loading")){var t=e.URL.split("#")[0].split("?")[0].split("/"),a=t[t.length-2],i=e.URL.split("/").pop();(a!==j.data("alpha")||i!==j.data("omega"))&&(j.data("alpha",a),j.data("omega",i),j.flog(j.data("alpha")+","+j.data("omega")),"customers"!=j.data("alpha")||isNaN(j.data("omega"))?"articles"!=j.data("alpha")||isNaN(j.data("omega"))?"pages"!=j.data("alpha")||isNaN(j.data("omega"))?"smart_collections"!=j.data("alpha")||isNaN(j.data("omega"))?"custom_collections"!=j.data("alpha")||isNaN(j.data("omega"))?"blogs"!=j.data("alpha")||isNaN(j.data("omega"))?"products"==j.data("alpha")?j.setup_products():"admin"==j.data("alpha")&&"products"==j.data("omega")?j.setup_products_list():"orders"!=j.data("alpha")||isNaN(j.data("omega"))?"admin"==j.data("alpha")&&"orders"==j.data("omega")?j.setup_orders():"admin"==j.data("alpha")&&"collections"==j.data("omega")?j.setup_collections():"admin"==j.data("alpha")&&"link_lists"==j.data("omega")?j.setup_link_lists():"admin"==j.data("alpha")&&"links"==j.data("omega")?j.setup_link_lists():"link_lists"!=j.data("alpha")||isNaN(j.data("omega"))?"admin"==j.data("alpha")&&"discounts"==j.data("omega")?j.setup_discounts():"settings"==j.data("alpha")&&"general"==j.data("omega")?j.setup_settings_general():"settings"==j.data("alpha")&&"files"==j.data("omega")?j.setup_files():"settings"==j.data("alpha")&&"shipping"==j.data("omega")?j.setup_shipping():"settings"==j.data("alpha")&&"taxes"==j.data("omega"):j.setup_link_lists_edit():j.setup_single_order():j.setup_blogs():j.setup_custom_collections():j.setup_custom_collections():j.setup_pages():j.setup_articles():j.setup_customers())}},j.data("wait"))},data:function(e,a){return"undefined"==typeof a?t[e]:(t[e]=a,void 0)},toggleStyle:function(){$("html").toggleClass("shopifyJSoverride")},isloading:function(){return j.data("content").hasClass("loading")}}}();j.load_css();var x=$("body"),T=$("<div>",{id:"shopifyJSbar","class":"loading noprint"}),C=$("<div>",{"class":"wrapper clearfix"}),E=$("<ul>",{id:"shopifyJSnav"});E.html(u),E.find("a").on("click",function(){if(j.isloading())j.notice("We better wait for this page to load first...",!0);else{var e=$(this),t=e.prop("id");if(!t)return!0;"manageinventory"==t&&"inventory"!==j.data("alpha")?j.redirect("/variants"):"bulkmetafields"==t?j.bulkmetafields():"themesettings"==t&&isNaN(j.data("alpha"))?j.redirect("/themes/current/settings"):"togglestyle"==t?(j.toggleStyle(),e.toggleClass("active")):"aboutapp"==t?j.about_app():"getnotifications"==t&&j.show_notification()}return!1}),C.append(E),T.append(C),x.append(T),T.removeClass("loading"),j.notice("ShopifyFD loaded"),j.init()}else alert("Error. This should be run within the Shopify Admin page.")}else alert("Error. jQuery not found.")}();