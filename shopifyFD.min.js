/*



      ############# 
    ##            *## 
   #        %      **#
  #        %%%    ***#
 #       %%F%D%%   ****#
#          %%%    *****#
#   ###     %     ###***# 
#  # ####       #### #**# 
#  #     #     #     #**# 
#   #####  # #  #####***# 
#         #   #  *******# 
 ### #           **# ### 
     # - - - - - - #                 
      | | | | | | |
	
     freakdesign.com               



	Written by jason from freakdesign.com.au

	Enjoying the tool? Consider leaving a tip:
  http://shopify.freakdesign.com.au/#donate

	Don't be cheeky and pass this off as your own work. Contribute to it instead for the good of the Shopify community. 


*/

(function(){if(typeof Shopify!="undefined"){if(typeof jQuery!="undefined"){if(!$("#shopifyjs").length){var x=document,h=x.URL;if(h.indexOf("myshopify.com/admin")>1){var u="Save",g="Edit",p="Delete",n="javascript:void(0)";var r='<label style="margin-top:1em">Add New Metafield</label><input class="ssb" type="text" id="metafield_namespace" placeholder="namespace"><input class="ssb" type="text" id="metafield_key" placeholder="key"><textarea class="ssb" id="metafield_value" placeholder="value"></textarea><input type="hidden" id="metafield_id"><a class="btn savemymeta" id="shopifyjs_savemetafield">'+u+'</a> <a class="int btn savemymeta" id="shopifyjs_savemetafield_int">Save as Integer</a> <a class="btn hidden delete" id="shopifyjs_deletemetafield">'+p+'</a><p style="margin-top:1em;line-height:1"><small>Please note: Using the save button top right will NOT save these metafields. Be sure to click '+u+" above.</small></p>";var A='<div class="sub_section-summary"><h1><strong>Metafields</strong> <span id="metacount">0</span></h1><div class="content"><i class="ico ico-20 ico-20-loading"></i></div></div>';var t='<option value="">Select or create a metafield</option>';var f='<div><a class="btn" id="fd_copymetafields">Copy Metafields</a> <a class="btn" id="fd_pastemetafields">Paste Metafields</a> <a class="btn" title="What have I copied?" href="#" id="fd_whatmetafields">?</a></div>';var l='<div id="rte_extra" style="background:#efefef"><a title="Careful, this method is brutal..." id="clearformatting" href="#">Purge html</a> <a id="createbackup" href="#">Create Backup</a> <a style="display:none;" id="restorebackup" href="#">Restore Backup</a> <a title="Add any images in the description to a Metafield" id="save_images_to_meta" href="#">Images to Metafields</a></div>';var a='<div class="vbox"><fieldset><select>'+t+'</select><input id="mv_namespace" placeholder="namespace" /><input id="mv_key" placeholder="key" /><input id="mv_value" placeholder="value" /></fieldset><span class="mybuttons"><a class="save" href="#">'+u+'</a> <a class="saveinteger" href="#">'+u+' as Integer</a> <a title="Delete" class="delete ico ico-16 ico-delete" href="#">delete</a></span></div>';var C='<li><a id="aboutapp" href="'+n+'">About ShopifyFD</a></li><li><a id="togglestyle" href="'+n+'">Toggle CSS</a></li><li><a id="themesettings" href="javascript:void(0)">Theme Settings</a></li><li><a id="manageinventory" href="'+n+'">Manage Inventory</a></li><li><a id="bulkmetafields" href="'+n+'">Bulk Metafields</a></li><li><a title="This tool is free, consider leaving a tip" href="http://shopify.freakdesign.com.au/#donate" target="_blank">Use this free tool? Tip me! ($)</a></li>';var s='<h2 class="warning"><strong>Warning:</strong> This section can make bulk changes to your product metafields. There is no undo should something go wrong so be very sure you want to attempt this.</h2><table><tr><td>Namespace</td><td><input id="bulk_namespace" placeholder="Namespace" type="text" /></td></tr><tr><td>Key</td><td><input id="bulk_key" placeholder="Key" type="text" /></td></tr><tr><td>Value</td><td><input id="bulk_value" type="text" placeholder="value" /></td></tr><tr><td colspan="2"><p><strong>Note:</strong> Any existing metafield with the same namespace and key will be overwritten. Have I given you enough warning?</p></td></tr><tr><td><a class="btn create">Save</a> <a class="btn createint">Save Integer</a></td><td><span style="display:none"><a class="btn delete">Delete</a> <input type="text" style="width:50%" placeholder="Type delete" /></span></td></tr><tr><td colspan="2"><textarea class="debug" placeholder="Data Output (future use only)"></textarea></td></tr></table>';var k='<li> <a id="autosave" tabindex="-1" class="btn slim tooltip" href="#"><span class="tooltip-container"><span class="tooltip-label">Enable Autosave</span></span>Autosave</a></li>';var e='<table><tr><td>How many days back do we search?</td><td><input value="30" id="from_recent_order_id" placeholder="days" type="text" /></td></tr><tr><td>Fulfillment Status</td><td><select id="recent_fulfillment_status"><option value="any">Any</option><option value="partial">Partial</option><option value="unshipped">Unshipped</option><option value="shipped">Shipped</option></select></td></tr><tr><td><a class="btn getdata">Get Emails</a></td><small>For now this grabs the email only and adds it to the box below. If you would like to see this work differently - let me know!</small><td></td></tr></table><textarea id="recent_emails_output" class="debug" placeholder="Email addresses will load here..."></textarea>';var v="<ul><li>Grab emails from recent orders now active.</li><li>Option to show SKUs on product page</li><li>Copy and paste metafields between products. Handy!</li><li>Bulk Metafield editor added. Be super careful with this one...</li></ul>";var q="What's new in ShopifyFD : 2013-10-09";var c='<table><tbody><tr><td width="50%">Oh hey! This tool has been made by Jason from freakdesign. He is awesome, and likes talking in the third person...</td><td><h4>Resources and links</h4><ul><li><a href="http://shopify.freakdesign.com.au" target="_blank">Project home page</a></li><li><a href="http://goo.gl/OsFK2d" target="_blank">Feature Request</a></li><li><a href="http://ecommerce.shopify.com/c/shopify-discussion/t/tool-to-add-new-dashboard-features-151067" target="_blank">Shopify forum post</a></li></ul></td></tr></tbody></table>';var z="<p>Do note that once you run this you are going to have to manually refresh to see the updates. Annoying I know, but I have not found a way around this...</p>";var B=(function(){var b={debug:false,drag_on:true,author:"freakdesign",version:20130829,alpha:false,omega:false,countries:false,wait:1000,api_count:0,api_limit:250,metafields:{},autosave:false,content:$("#content")};return{escape:function(d){return d.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\/]/g,"\\/").replace(/[\b]/g,"\\b").replace(/[\f]/g,"\\f").replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r").replace(/[\t]/g,"\\t")},redirect:function(d){if(d){Batman.redirect(d)}},createCookie:function(E,F,G){if(G){var D=new Date();D.setTime(D.getTime()+(G*24*60*60*1000));var d="; expires="+D.toGMTString()}else{var d=""}document.cookie=E+"="+F+d+"; path=/"},readCookie:function(D){var F=D+"=",d=document.cookie.split(";");for(var E=0;E<d.length;E++){var G=d[E];while(G.charAt(0)==" "){G=G.substring(1,G.length)}if(G.indexOf(F)==0){return G.substring(F.length,G.length)}}return null},notice:function(d,D){if(D){Shopify.Flash.error(d)}else{Shopify.Flash.notice(d)}},about_app:function(){B.fd_modal(true,c,"About App",true);return false},createbackup:function(F){if(F){var D=$("iframe").contents().find("#tinymce"),E=D.html(),d={metafield:{namespace:"backups",key:F,value:E,value_type:"string"}};$.ajax({type:"POST",url:x.URL+"/metafields.json",dataType:"json",data:d,success:function(G){B.updatedropdown();B.notice("Backup saved")}})}},loadmeta:function(E,d){var D="/admin/"+B.data("alpha")+"/"+B.data("omega")+"/metafields.json";if(B.data("omega")==="general"){D="/admin/metafields.json"}if(B.data("alpha")==="articles"){D="/admin/articles/"+B.data("omega")+"/metafields.json"}$.getJSON(D,function(J){var I="",G=J.metafields;if(G){B.data("m",G);if(B.data("alpha")=="products"){B.setup_copypaste()}$("#metacount").text(G.length).addClass("active");if(G.length===0){$("#metacount").removeClass("active")}else{$("#metacount").addClass("active")}for(var H=0,F=G.length;H<F;H++){I+='<option data-id="'+G[H].id+'">'+G[H].namespace+"."+G[H].key+"</option>";d.metafields[G[H].id]={namespace:G[H].namespace,value:G[H].value,key:G[H].key};if(G[H].namespace=="backups"){B.flog("hasbackup!");$("#restorebackup").show();B.data("hasbackup",true)}}I='<select id="metafieldselect">'+t+I+"</select>"}else{I='<select id="metafieldselect">'+t+"</select>"}E.html(I).append(r);$("#metafieldselect").change(function(){var L=$(this).find(":selected");if(L.attr("data-id")){var K=d.metafields[L.attr("data-id")];$("#metafield_namespace").val(K.namespace).prop("disabled",true);$("#metafield_key").val(K.key).prop("disabled",true);$("#metafield_value").val(K.value);$("#metafield_id").val(L.attr("data-id"));$("#shopifyjs_deletemetafield").removeClass("hidden")}else{B.clearmetaform()}});$("#shopifyjs_deletemetafield").on("click",function(){var L=$("#metafield_id").val(),K=x.URL+"/metafields/"+L+".json";if(B.data("omega")==="general"){K="/admin/metafields/"+L+".json"}if(B.data("alpha")==="articles"){K="/admin/articles/"+B.data("omega")+"/metafields/"+L+".json"}if(L){$.ajax({type:"DELETE",url:K,success:function(M){B.flog(M);B.notice("Metafield deleted");B.updatedropdown()},error:function(M){B.notice("Failed to delete",true)}})}});$("div.sub_section-summary a.savemymeta").off("click").on("click",function(){var O="string";if($(this).hasClass("int")){O="integer"}var Q=$("#metafield_namespace").val(),K=$("#metafield_key").val(),R=$("#metafield_value").val(),M=$("#metafield_id").val();var N={metafield:{namespace:Q,key:K,value:R,value_type:O}};var P={metafield:{id:M,value:R,value_type:O}};if(M.length>5){var L=x.URL+"/metafields/"+M+".json";if(B.data("omega")==="general"){L="/admin/metafields/"+M+".json"}$.ajax({type:"PUT",url:L,dataType:"json",data:P,success:function(S){B.updatedropdown();B.flog(S);B.notice("Metafield updated");Batman.DOM.Modal.hide()}})}else{var L=x.URL+"/metafields.json";if(B.data("omega")==="general"){L="/admin/metafields.json"}if(B.data("alpha")==="articles"){L="/admin/articles/"+B.data("omega")+"/metafields.json"}$.ajax({type:"POST",url:L,dataType:"json",data:N,success:function(S){B.updatedropdown();B.notice("Metafield saved")}})}return false})})},bulk_save_metafield_queue:function(d,D,E){$.ajax({type:"POST",url:"/admin/products/"+B.data("products")[D].id+"/metafields.json",dataType:"json",data:d,success:function(G){if(E){var F=E.val();E.val(F+D+": "+B.data("products")[D].id+": ok\n")}if(D+1<B.data("products").length){B.bulk_save_metafield_queue(d,D+1,E)}else{if(B.data("alpha")=="products"){B.updatedropdown()}Shopify.Flash.notice("Bulk changes done!")}}})},bulkmetafields:function(){var H=$(s),d="I did say these are not working right?",J=H.find("a.create"),F=H.find("a.createint"),E=H.find("a.update"),D=H.find("a.delete"),G=H.find("#bulk_namespace"),M=H.find("#bulk_key"),I=H.find("#bulk_value"),L=H.find("textarea.debug"),K=function(){return 1<G.val().length&&1<M.val().length&&1<I.val().length?!0:!1};J.off("click").on("click",function(){if(K){var N={metafield:{namespace:G.val(),key:M.val(),value:I.val(),value_type:"string"}};B.bulk_save_metafield_queue(N,0,L)}else{B.notice("No empty fields allowed")}});F.off("click").on("click",function(){if(K){if(!isNaN(I.val())){L.val(B.data("products"));var N={metafield:{namespace:G.val(),key:M.val(),value:I.val(),value_type:"integer"}};B.bulk_save_metafield_queue(N,0,L)}else{B.notice("Value not an integer",true)}}else{B.notice("No empty fields allowed",true)}});$.ajax({type:"GET",url:"/admin/products.json?fields=id,title",dataType:"json",success:function(N){if(N.products){if(N.products.length){B.data("products",N.products);B.fd_modal(true,H,"Bulk Metafield editing (for "+N.products.length+" products)",true)}else{B.notice("No products found",true)}}},error:function(N){B.notice("Error getting products",true)}})},clearformatting:function(){var d=$("iframe").contents().find("#tinymce"),E=document.createElement("div");E.innerHTML=d.html();var D=E.textContent||E.innerText||"";d.text(D)},clearmetaform:function(){$("#metafield_namespace").val("").prop("disabled",false);$("#metafield_key").val("").prop("disabled",false);$("#metafield_value").val("");$("#metafield_id").val("");$("#shopifyjs_deletemetafield").addClass("hidden")},supports_html5_storage:function(){try{return"localStorage" in window&&window.localStorage!==null}catch(d){return false}},kill_drag_drop:function(){if(B.data("drag_on")){var d=document.documentElement;d.className="";d.ondragover=function(){return false};d.ondragleave=function(){return false};d.ondragend=function(){return false};d.ondrop=function(){}}},set_drag_drop:function(){if(B.data("drag_on")){var d=function(){var E=document.createElement("div");return("draggable" in E)||("ondragstart" in E&&"ondrop" in E)};if(d()){B.flog("has dnd");var D=document.documentElement;D.ondragover=function(){this.className="dragit";return false};D.ondragleave=function(){this.className="";return false};D.ondragend=function(){this.className="";return false};D.ondrop=function(H){H.preventDefault&&H.preventDefault();var G=H.dataTransfer.files,F=G.length,J=0,E=new FileReader(),I={};E.onload=function(M){B.flog("load");var L=M.target.result;var K=L.split(",")[1];I[J]={name:G[J].name,data:K};J++;if(J<F){B.notice("Reading file ["+(J+1)+"] contents...");E.readAsDataURL(G[J])}else{B.do_upload(I)}};if(F){document.documentElement.className="dragit";B.notice("Reading file ["+(J+1)+"] contents...");E.readAsDataURL(G[J])}return false}}}},do_upload:function(I){if(B.data("drag_on")){var F=I,D=Object.keys(I).length,H=0,G=B.data("themeID");if(B.data("alpha")=="themes"){G=B.data("omega")}if(B.data("omega")=="settings"&&!isNaN(B.data("alpha"))){G=B.data("alpha")}if(G){var E=function(){var d={asset:{key:"assets/"+F[H].name,attachment:F[H].data}};$.ajax({type:"PUT",url:"/admin/themes/"+G+"/assets.json",data:d,success:function(){B.notice(F[H].name+" uploaded ("+(H+1)+"/"+D+")");H++;if(H<D){E()}if(H==D){document.documentElement.className=""}},error:function(){B.notice("File upload failed",true);document.documentElement.className=""}})};E()}else{B.notice("Theme ID not found",true)}}},get_product_count:function(){$.ajax({type:"GET",url:"/admin/products/count.json",success:function(D){if(D){B.data("product_count",D.count)}}})},get_all_product_metafields:function(){if(B.data("product_count")<=B.data("api_limit")){}else{}},save_variant_metafield:function(J,F,D,H,d,E){B.flog(J,F,D,H,d,E);var G="string";if(E){G="integer"}if(!d.length){var I={metafield:{namespace:F,key:D,value:H,value_type:G}};$.ajax({type:"POST",url:"/admin/variants/"+J+"/metafields.json",data:I,success:function(K){B.flog(K);B.setup_vrow(J);B.notice("Metafield saved")},error:function(K){B.setup_vrow(J);B.notice("Error Saving",true)}})}else{var I={metafield:{id:d,value:H,value_type:G}};$.ajax({type:"PUT",url:"/admin/variants/"+J+"/metafields/"+d+".json",data:I,success:function(K){B.flog(K);B.setup_vrow(J);B.notice("Metafield updated")},error:function(K){B.setup_vrow(J);B.notice("Error saving",true)}})}},delete_variant_metafield:function(D,d){$.ajax({type:"DELETE",url:"/admin/variants/"+D+"/metafields/"+d+".json",success:function(E){B.flog(E);B.setup_vrow(D);B.notice("Metafield deleted")},error:function(E){B.setup_vrow(D);B.notice("Failed to delete",true)}})},variant_fillfields:function(F){var E=false;for(var D=0,d=B.data("vm").length;D<d;D++){o=B.data("vm")[D];if(parseInt(o.id)==parseInt(F)){return(o)}}return E},setup_vrow:function(d){Batman.DOM.Modal.show();$("#mv_namespace").val("").prop("disabled",false);$("#mv_key").val("").prop("disabled",false);$("#mv_value").val("");B.data("current_vid","");var D=function(E){return'<option class="meta" value="'+E.id+'">'+E.namespace+"."+E.key+"</option>"};if(d){$.ajax({type:"GET",url:"/admin/variants/"+d+"/metafields.json",success:function(G){$("#vrow option.meta").remove();m=G.metafields;if(m){B.data("vm",m);if(m.length){$("#vrow select").addClass("active")}else{$("#vrow select").removeClass("active")}}for(var F=0,E=m.length;F<E;F++){$("#vrow select").append(D(m[F]))}$("#vrow .delete").hide();$("#vrow .save").off("click").on("click",function(){Batman.DOM.Modal.show();if(!B.data("current_vid")){B.data("current_vid","")}B.save_variant_metafield(d,$("#mv_namespace").val(),$("#mv_key").val(),$("#mv_value").val(),B.data("current_vid"));return false});$("#vrow .saveinteger").off("click").on("click",function(){Batman.DOM.Modal.show();if(!B.data("current_vid")){B.data("current_vid","")}B.save_variant_metafield(d,$("#mv_namespace").val(),$("#mv_key").val(),$("#mv_value").val(),B.data("current_vid"),true);return false});$("#vrow .delete").off("click").on("click",function(){Batman.DOM.Modal.show();B.delete_variant_metafield(d,B.data("current_vid"));return false});$("#vrow select").eq(0).off("change").change(function(){var H=$(this).val();B.data("current_vid",H);B.flog(B.data("vm"));if(H.length){$("#mv_namespace").prop("disabled",true);$("#mv_key").prop("disabled",true);$("#vrow .delete").show();var I=B.variant_fillfields(H);if(I){$("#mv_namespace").val(I.namespace);$("#mv_key").val(I.key);$("#mv_value").val(I.value)}}else{$("#mv_namespace").prop("disabled",false);$("#mv_key").prop("disabled",false);$("#vrow .delete").hide()}});$("#vrow .mybuttons").fadeIn(function(){Batman.DOM.Modal.hide()})},error:function(E){Shopify.Flash.error("Error grabbing metafields");Batman.DOM.Modal.hide()}})}else{Shopify.Flash.error("Could not find ID")}},panel_editvariantmeta:function(){$(".row.section.inventory .section-summary p").after("<p>To edit metafields for the variant click on the variant ID number.</p>");$("td.vid").on("click",function(){Batman.DOM.Modal.show();$("#vrow").remove();var d=$(this).text();B.flog(d);B.data("currentvrow",d);$("tr.variant.active").removeClass("active");$(this).parent().addClass("active").after('<tr id="vrow"><td colspan="8">'+a+"</td></tr>");B.setup_vrow(d)})},btn_removealltags:function(){$("div.row.section.tags div.section-summary").eq(0).append('<a id="addalltags" href="#" class="btn">Add all tags</a> <a id="removealltags" href="#" class="btn">Remove all tags</a>');$("#removealltags").on("click",function(){$("ul.tokenized-list").eq(0).find("a").click();return false});$("#addalltags").on("click",function(){$("ul.addtags").eq(0).find("span:not(.inactive)").click();return false})},flog:function(d){if(B.data("debug")){console.log(d)}},fd_modal_update:function(D,E,F){var d=$("#fdmodal");if(d.length){d.remove()}},fd_modal:function(G,H,K,I){B.flog("fdmodal");var F=$("#fdmodal");if(G){if(F.length){F.remove()}var D=$('<div id="fdmodal" class="modalWindow"><div class="main content"><header></header></div></div>');if(K){D.find("header").html("<h2>"+K+"</h2>")}if(H){var J=$("<div/>",{}).append(H);D.find("div.main.content").append(J)}if(!I){D.fadeIn().on("click",function(){B.fd_modal(false)})}else{var E=$('<a href="#" class="close-modal">x</a>');E.on("click",function(){B.fd_modal(false);return false});D.find("header").prepend(E).end().fadeIn()}$("body").append(D)}else{F.off("click").remove()}},create_discounts:function(d){},restorebackup:function(G){var F=$("iframe").contents().find("#tinymce");var D=B.data("m");if(D){for(var E=0,d=D.length;E<d;E++){if(D[E].namespace=="backups"){F.html(D[E].value);B.notice("Backup restored")}}}else{B.notice("Error, nothing to restore")}},setup_discounts:function(){var F=$("<ul/>",{"class":"segmented",id:"showsku"}),E=$("<li/>"),D=$("<a/>",{"class":"btn btn-separate",href:"#",title:"Disable all codes below"}).html("Disable codes").on("click",function(){$('#discount-table a[data-event-click="discount.disable"]').click();return false}),d=$("<a/>",{"class":"btn btn-separate",href:"#",title:"Enable all codes below"}).html("Enable codes").on("click",function(){$('#discount-table a[data-event-click="discount.enable"]').click();return false}),G=$("<a/>",{"class":"btn btn-separate disabled",href:"#"}).html("Bulk create").on("click",function(){if(B.data("debug")){}else{B.fd_modal(true,"<p>This is on the todo list. Will get to it soon(ish)</p></div>","Bulk create discount codes",true)}return false});E.append(D,d,G);F.append(E);$(".header-right .segmented").eq(0).after(F)},setup_articles:function(){B.flog("setup_articles");$("div.span6.section-summary a.view-in-store").remove();$("div.span6.section-summary").eq(0).find("p, h1").remove().end().append(A);var d=$("div.sub_section-summary .content");B.loadmeta(d,b)},setup_blogs:function(){$("div.span6.section-summary a.view-in-store").remove();$("div.span6.section-summary").eq(0).find("p, h1").remove().end().append(A);var d=$("div.sub_section-summary .content");window.setTimeout(function(){B.loadmeta(d,b)},250)},setup_rte:function(){if(B.data("hasbackup")){$("#restorebackup").show()}$("#clearformatting").on("click",function(){B.clearformatting();return false});$("#createbackup").on("click",function(){B.createbackup(B.data("omega"));return false});$("#restorebackup").on("click",function(){B.restorebackup(B.data("omega"));return false});$("#save_images_to_meta").on("click",function(){B.save_images_to_meta();return false})},save_images_to_meta:function(){var d=$("iframe").contents().find("#tinymce").find("img");if(d&&d.length){var E="";d.each(function(F){var G=$(this).prop("src").replace(/https:/i,"");E+=G;if(F<d.length-1){E+=","}});var D={metafield:{namespace:"helpers",key:"images",value:E,value_type:"string"}};$.ajax({type:"POST",url:x.URL+"/metafields.json",dataType:"json",data:D,success:function(F){B.updatedropdown();B.notice("Images saved to metafield")},error:function(F){B.notice("Error saving",true)}})}else{B.notice("No images found",true)}},setup_products_list:function(){if(!$("#showsku").length){var E=$("<ul/>",{"class":"segmented",id:"showsku"}),D=$("<li/>"),d=$("<a/>",{"class":"btn",href:"#"}).html("Show SKUs").on("click",function(){var H=[],J=[],I=$("#all-products td.name a");I.each(function(){H.push($(this).attr("href").split(/[/]+/).pop())});if(H.length){var G=0,F=function(L,K){$.ajax({type:"GET",url:"/admin/products/"+L[K]+".json?fields=variants",dataType:"json",success:function(N){var M=N.product.variants[0].sku;if(M){I.eq(K).before('<span title="SKU" class="sku label">'+M+"</span>")}if(K+1<L.length){F(L,K+1)}else{B.fd_modal(false)}}})};B.fd_modal(true,"Loading SKUs, please wait...","Loading",true);F(H,G)}return false});D.append(d);E.append(D);$(".header-right .segmented").eq(1).after(E)}},seo_description:function(){var D=$("#seo-description-tag");var d=$("<textarea/>");d.val(D.val()).keyup(function(){D.val($(this).val())});D.after(d).hide()},setup_copypaste:function(){var d=$(f),E=d.find("#fd_pastemetafields"),D=d.find("#fd_whatmetafields");d.find("#fd_copymetafields").on("click",function(){if(B.data("m")){B.data("m-copy",B.data("m"));B.notice(B.data("m-copy").length+" Metafields copied");E.show();D.show()}else{E.hide();D.hide()}return false});D.on("click",function(){if(B.data("m-copy")){var I="";var G=B.data("m-copy");for(var H=0,F=G.length;H<F;H++){I+="<p><strong>"+G[H].namespace+"."+G[H].key+" ("+G[H].value_type+")</strong><br>"+G[H].value+"</p><hr>"}B.fd_modal(true,I,"In the virtual clipboard...")}return false});E.on("click",function(){if(B.data("m-copy")){B.save_metafield_queue(B.data("m-copy"),0)}return false});if(!B.data("m-copy")){E.hide();D.hide()}$("div.sub_section-summary").after(d)},save_metafield_queue:function(E,d){B.fd_modal(true,"","Please wait whilst we past the metafields",true);var D={metafield:{namespace:E[d].namespace,key:E[d].key,value:E[d].value,value_type:E[d].value_type}};$.ajax({type:"POST",url:x.URL+"/metafields.json",dataType:"json",data:D,success:function(F){if(d+1<E.length){B.save_metafield_queue(E,d+1)}else{B.updatedropdown();B.fd_modal(false);Shopify.Flash.notice("Pasted!")}}})},setup_products:function(){$("div.span6.section-summary").eq(0).append(A).find("div:first-child").remove();if($("#rte_extra").length==0){$("#product-body-html_ifr").eq(0).after(l);B.setup_rte()}else{B.notice("Bug! I tried to load the content editor twice.",true)}if(B.data("debug")){$(".rtetools-buttons ul.fr").eq(1).append(k);$("#autosave").on("click",function(){var G=$(this);if(G.hasClass("rte-command-active")){Shopify.Flash.notice("Autosave disabled");clearInterval(B.data("autosave"))}else{Shopify.Flash.notice("Autosave enabled");B.data("autosave",setInterval(function(){$('header input[type="submit"]').click()},30000))}$(this).toggleClass("rte-command-active");return false})}B.btn_removealltags();B.seo_description();var E=$("div.span6.section-summary a.view-in-store"),d=$('h1.header-main span[data-bind="product.title"]'),F=$("div.sub_section-summary .content"),D={};d.addClass("view-in-store").html('<a target="shopify_storeview" href="'+E.prop("href")+'">'+d.text()+"</a>").prop("title","View in store");E.remove();B.loadmeta(F,b);$("#product-inner-variants th:last-child").before("<th>Variant ID</th>");$("th.inventory.tc").text("#").prop("title","Quantity");$("tr.variant").each(function(G){var H=$("td.sku input.mock-edit-on-hover").eq(G).prop("id").split(/[- ]+/).pop();D["variant_"+G]={id:H};$(this).find("td:last-child").before('<td class="vid">'+H+"</td>")}).promise().done(function(){B.panel_editvariantmeta()})},setup_pages:function(){var D=$("div.span6.section-summary a.view-in-store"),d=$('h1.header-main span[data-bind="page.title"]');$("#page-content_ifr").eq(0).after(l);B.setup_rte();d.addClass("view-in-store").html('<a target="shopify_storeview" href="'+D.prop("href")+'">'+d.text()+"</a>").prop("title","View in store");B.seo_description();D.remove();$("div.span6.section-summary").eq(0).find("p, h1").remove().end().append(A);var E=$("div.sub_section-summary .content");B.loadmeta(E,b);$.ajax({type:"GET",url:"/admin/pages.json",dataType:"json",success:function(I){if(I){pages=I.pages;var G="";for(var H=0,F=pages.length;H<F;H++){if(B.data("omega")!==pages[H].id.toString()){G+='<option value="'+pages[H].id+'">'+pages[H].title+"</option>"}}$(".header-row .header-right").prepend('<select id="shopifyjs_pageselect"><option>Choose another page to edit</option>'+G+"</select>");$("#shopifyjs_pageselect").change(function(){var J=$(this).val();if(J){B.redirect("/pages/"+J)}})}},error:function(F){B.notice("Error loading page data",true)}})},shipping_remove_all:function(D,E){if(D>=0){$.ajax({type:"DELETE",url:"/admin/countries/"+E[D].id+".json",dataType:"json",success:function(F){Shopify.Flash.notice("removed "+E[D].name);D=D-1;B.shipping_remove_all(D,E)}})}else{var d="/admin/settings/shipping";$.ajax({url:d,success:function(){$("div.shipping-rate-table").remove();B.fd_modal(false);B.redirect("/settings/shipping")}})}},setup_shipping:function(){var E=$("#settings-shipping"),D=$('<div class="header-right"><div class="header-action"><ul class="segmented"><li><a class="btn" href="#">Bulk Updates</a></li><li><a class="btn delete btn-separate" href="#">Delete all rates</a></li></ul></div></div>');D.find("a").eq(0).on("click",function(){var F=$('<h2 class="warning"><strong>Warning:</strong> This section can make bulk changes to your Shipping rates. There is no undo.</h2><div><div class="span1"><p>Soon...</p></div><div class="span2">'+z+"</div></div>");B.fd_modal(true,F,"Bulk Updates",true);return false});D.find("a").eq(1).on("click",function(){var F=$('<h2 class="warning"><strong>Warning:</strong> This will delete ALL of your shipping rates. There is no undo.</h2><div><div class="span1"><a href="#" class="btn delete_all delete">Delete</a></div><div class="span2">'+z+"</div></div>");F.find("a.delete_all").on("click",function(){$.ajax({type:"GET",url:"/admin/countries.json",dataType:"json",success:function(G){if(G.countries.length){b.countries=G.countries;B.notice(G.countries.length+" countries returned");B.shipping_remove_all(G.countries.length-1,G.countries)}else{B.notice("The list did not return as expected... empty?",true)}}});return false});B.fd_modal(true,F,"Delete all shipping rates",true);return false});E.find("header").eq(0).append(D);if(B.data("debug")){function d(J,H,F,G,I){$.post("/admin/weight_based_shipping_rates.json",{weight_based_shipping_rate:{country_id:J,name:G,offsets:[],weight_high:F,weight_low:H,price:I}})}}},setup_custom_collections:function(){$("div.row.section.visibility").eq(0).after('<div class="row section" id="customer_meta_box"><div class="span12 section-summary">'+A+"</div></div>");var d=$("div.sub_section-summary .content");B.loadmeta(d,b)},setup_settings_general:function(){var E=$("<div>",{id:"general_metafields","class":"row section description"}),d=$("<div>",{"class":"span6 section-summary"}),D=$("<div>",{"class":"span18 section-content"});d.html("<h1>Store Metafields</h1><p>Edit your most awesome shop level metafields here...</p>");D.html(A);E.append(d).append(D);$("div.row.section.description.first-section").eq(0).after(E);var F=$("div.sub_section-summary .content");B.loadmeta(F,b)},setup_customers:function(){$("section.customer-details.ssb .box-details").eq(0).after('<div id="customer_meta_box" class="box box-details"><div class="box-header p"><h3>Metafields</h3></div><div class="box-content p">'+A+"</div>");var d=$("div.sub_section-summary .content");B.loadmeta(d,b)},setup_single_order:function(){$("div.order-sidebar .box-details").eq(0).after('<div id="customer_meta_box" class="box box-details"><div class="box-header p"><h3>Metafields</h3></div><div class="box-content p">'+A+"</div>");var d=$("div.sub_section-summary .content");B.loadmeta(d,b)},setup_orders:function(){var E=$("<ul/>",{"class":"segmented",id:"showsku"}),D=$("<li/>"),d=$("<a/>",{"class":"btn",href:"#"}).html("Get emails").on("click",function(){var F=$(e);F.find("a.getdata").on("click",function(){var O=$("#recent_emails_output"),H=new Date(),G=30,N=$("#from_recent_order_id").val(),K=$("#recent_fulfillment_status").val();O.val("");if(N.length>0){G=parseInt(N)}H.setDate(H.getDate()-G);var L=H.getDate(),I=H.getMonth()+1,M=H.getFullYear();var J=M+"-"+(I<=9?"0"+I:I)+"-"+(L<=9?"0"+L:L)+" 00:00";B.flog(H);B.flog(J);$.ajax({type:"GET",url:"/admin/orders.json?fields=email&fulfillment_status="+K+"&created_at_min="+J,success:function(T){if(T.orders.length){var S=T.orders,Q="";for(var R=0,P=S.length;R<P;R++){B.flog(S[R].email);Q+=S[R].email+",\n"}O.val(Q)}else{B.notice("Error. No results returned",true)}}})});B.fd_modal(true,F,"Get recent order emails",true);return false});D.append(d);E.append(D);$(".header-right .segmented").eq(1).after(E)},get_recent_emails:function(d){},shortcut_to_open_orders:function(){$('#sidebar span[data-bind="Order.openCount"]').on("click",function(){B.redirect("/orders?query=+financial_status%3Aany+status%3Aopen")}).prop("title","Jump to open orders")},updatedropdown:function(){var d=x.URL+"/metafields.json";if(B.data("omega")==="general"){d="/admin/metafields.json"}if(B.data("alpha")==="articles"){d="/admin/articles/"+B.data("omega")+"/metafields.json"}$.getJSON(d,function(H){var F="";var E=H.metafields;if(E.length){B.data("m",E);$("#metacount").text(E.length).addClass("active");for(var G=0,D=E.length;G<D;G++){F+='<option data-id="'+E[G].id+'">'+E[G].namespace+"."+E[G].key+"</option>";b.metafields[E[G].id]={namespace:E[G].namespace,value:E[G].value,key:E[G].key};if(E[G].namespace=="backups"){$("#restorebackup").show()}}F=t+F}else{$("#metacount").text("0").removeClass("active");B.data("m",false);$("#restorebackup").hide();F=t}$("#metafieldselect").html(F);B.clearmetaform()})},load_css:function(){var d=document.createElement("link");d.type="text/css";d.rel="stylesheet";d.id="shopifyjs";d.href="//dl.dropbox.com/s/kz1eyogfmmpmiby/shopifyJS.css";document.body.appendChild(d)},get_theme_data:function(){if(!B.data("themeID")){$.ajax({type:"GET",url:"/admin/themes.json",success:function(D){if(D){B.data("themeID",D.themes[0].id);B.data("themeName",D.themes[0].name)}}})}},init:function(){B.shortcut_to_open_orders();B.set_drag_drop();B.get_theme_data();if(!B.data("debug")){if(!B.readCookie("shopifyfd")){B.fd_modal(true,v,q);B.createCookie("shopifyfd","loaded",3)}}$("#togglestyle").click();setInterval(function(){if(!B.data("content").hasClass("loading")){var d=x.URL.split("#")[0].split("?")[0].split("/"),D=d[d.length-2],E=x.URL.split("/").pop();if(D!==B.data("alpha")||E!==B.data("omega")){B.data("alpha",D);B.data("omega",E);B.flog(B.data("alpha")+","+B.data("omega"));if(B.data("alpha")=="customers"&&!isNaN(B.data("omega"))){B.setup_customers()}if(B.data("alpha")=="articles"&&!isNaN(B.data("omega"))){B.setup_articles()}if(B.data("alpha")=="pages"&&!isNaN(B.data("omega"))){B.setup_pages()}if(B.data("alpha")=="smart_collections"&&!isNaN(B.data("omega"))){B.setup_custom_collections()}if(B.data("alpha")=="custom_collections"&&!isNaN(B.data("omega"))){B.setup_custom_collections()}if(B.data("alpha")=="blogs"&&!isNaN(B.data("omega"))){}if(B.data("alpha")=="settings"&&B.data("omega")=="general"){B.setup_settings_general()}if(B.data("alpha")=="products"){B.setup_products()}if(B.data("alpha")=="admin"&&B.data("omega")=="products"){B.setup_products_list()}if(B.data("alpha")=="orders"&&!isNaN(B.data("omega"))){B.setup_single_order()}if(B.data("alpha")=="admin"&&B.data("omega")=="orders"){B.setup_orders()}if(B.data("alpha")=="admin"&&B.data("omega")=="discounts"){B.setup_discounts()}if(B.data("alpha")=="settings"&&B.data("omega")=="shipping"){B.setup_shipping()}if(B.data("alpha")=="settings"&&B.data("omega")=="taxes"){}}}},B.data("wait"))},data:function(D,d){if("undefined"===typeof d){return b[D]}b[D]=d},toggleStyle:function(){$("html").toggleClass("shopifyJSoverride");B.flog("toggleStyle")},getMetafields:function(){alert("getMetafields")},isloading:function(){return B.data("content").hasClass("loading")}}}());B.load_css();var y=$("body"),w=$("<div>",{id:"shopifyJSbar","class":"loading"}),i=$("<div>",{"class":"wrapper clearfix"}),j=$("<ul>",{id:"shopifyJSnav"});j.html(C);j.find("a").on("click",function(){if(!B.isloading()){var b=$(this),d=b.prop("id");if(d){if(d=="manageinventory"&&B.data("alpha")!=="inventory"){B.redirect("/variants")}if(d=="bulkmetafields"){B.bulkmetafields()}if(d=="themesettings"&&isNaN(B.data("alpha"))){if(!B.data("themeID")){$.ajax({type:"GET",url:"/admin/themes.json",success:function(D){if(D){B.data("themeID",D.themes[0].id);B.redirect("/themes/"+B.data("themeID")+"/settings")}}})}else{B.redirect("/themes/"+B.data("themeID")+"/settings")}}if(d=="togglestyle"){B.toggleStyle();b.toggleClass("active")}if(d=="aboutapp"){B.about_app()}}else{return true}}else{Shopify.Flash.error("We better wait for this page to load first...")}return false});i.append(j);w.append(i);y.append(w);w.removeClass("loading");B.notice("ShopifyFD loaded");Batman.DOM.Modal.hide();B.init()}else{alert("Error. This should be run within the Shopify Admin page.")}}else{B.notice("Error. ShopifyFD already loaded!",true)}}else{alert("Error. jQuery not found.")}}}());